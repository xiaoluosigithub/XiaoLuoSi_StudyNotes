#### ![](https://i-blog.csdnimg.cn/blog_migrate/5ba45e7bdf3c689b938aac99d86f17b2.gif) 

![](https://i-blog.csdnimg.cn/blog_migrate/4a7d26b7e1548714077bb435fae56cb0.png)

![962f7cb1b48f44e29d9beb1d499d0530.gif](https://i-blog.csdnimg.cn/blog_migrate/ac3c5d6bfbcbf982e8e9e3632d7f20d1.gif)„ÄêYOLOv5ÊîπËøõÁ≥ªÂàó„ÄëÂâçÊúüÂõûÈ°æÔºö

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà0Ôºâ‚Äî‚ÄîÈáçË¶ÅÊÄßËÉΩÊåáÊ†á‰∏éËÆ≠ÁªÉÁªìÊûúËØÑ‰ª∑ÂèäÂàÜÊûê][YOLOv5_0]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà1Ôºâ‚Äî‚ÄîÊ∑ªÂä†SEÊ≥®ÊÑèÂäõÊú∫Âà∂][YOLOv5_1_SE]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà3Ôºâ‚Äî‚ÄîÊ∑ªÂä†CAÊ≥®ÊÑèÂäõÊú∫Âà∂][YOLOv5_3_CA]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà4Ôºâ‚Äî‚ÄîÊ∑ªÂä†ECAÊ≥®ÊÑèÂäõÊú∫Âà∂][YOLOv5_4_ECA]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà5Ôºâ‚Äî‚ÄîÊõøÊç¢‰∏ªÂπ≤ÁΩëÁªú‰πã MobileNetV3][YOLOv5_5_ MobileNetV3]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà6Ôºâ‚Äî‚ÄîÊõøÊç¢‰∏ªÂπ≤ÁΩëÁªú‰πã ShuffleNetV2][YOLOv5_6_ ShuffleNetV2]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà7Ôºâ‚Äî‚ÄîÊ∑ªÂä†SimAMÊ≥®ÊÑèÂäõÊú∫Âà∂][YOLOv5_7_SimAM]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà8Ôºâ‚Äî‚ÄîÊ∑ªÂä†SOCAÊ≥®ÊÑèÂäõÊú∫Âà∂][YOLOv5_8_SOCA]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà9Ôºâ‚Äî‚ÄîÊõøÊç¢‰∏ªÂπ≤ÁΩëÁªú‰πãEfficientNetv2][YOLOv5_9_EfficientNetv2]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà10Ôºâ‚Äî‚ÄîÊõøÊç¢‰∏ªÂπ≤ÁΩëÁªú‰πãGhostNet][YOLOv5_10_GhostNet]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà11Ôºâ‚Äî‚ÄîÊ∑ªÂä†ÊçüÂ§±ÂáΩÊï∞‰πãEIoU„ÄÅAlphaIoU„ÄÅSIoU„ÄÅWIoU][YOLOv5_11_EIoU_AlphaIoU_SIoU_WIoU]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà12Ôºâ‚Äî‚ÄîÊõ¥Êç¢Neck‰πãBiFPN][YOLOv5_12_Neck_BiFPN]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà13Ôºâ‚Äî‚ÄîÊõ¥Êç¢ÊøÄÊ¥ªÂáΩÊï∞‰πãSiLUÔºåReLUÔºåELUÔºåHardswishÔºåMishÔºåSoftplusÔºåAconCÁ≥ªÂàóÁ≠â][YOLOv5_13_SiLU_ReLU_ELU_Hardswish_Mish_Softplus_AconC]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà14Ôºâ‚Äî‚ÄîÊõ¥Êç¢NMSÔºàÈùûÊûÅÂ§ßÊäëÂà∂Ôºâ‰πã DIoU-NMS„ÄÅCIoU-NMS„ÄÅEIoU-NMS„ÄÅGIoU-NMS „ÄÅSIoU-NMS„ÄÅSoft-NMS][YOLOv5_14_NMS_ DIoU-NMS_CIoU-NMS_EIoU-NMS_GIoU-NMS _SIoU-NMS_Soft-NMS]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà15Ôºâ‚Äî‚ÄîÂ¢ûÂä†Â∞èÁõÆÊ†áÊ£ÄÊµãÂ±Ç][YOLOv5_15]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà16Ôºâ‚Äî‚ÄîÊ∑ªÂä†EMAÊ≥®ÊÑèÂäõÊú∫Âà∂ÔºàICASSP2023|ÂÆûÊµãÊ∂®ÁÇπÔºâ][YOLOv5_16_EMA_ICASSP2023]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà17Ôºâ‚Äî‚ÄîÊõ¥Êç¢IoU‰πãMPDIoUÔºàELSEVIER 2023|Ë∂ÖË∂äWIoU„ÄÅEIoUÁ≠â|ÂÆûÊµãÊ∂®ÁÇπÔºâ][YOLOv5_17_IoU_MPDIoU_ELSEVIER 2023_WIoU_EIoU]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà18Ôºâ‚Äî‚ÄîÊõ¥Êç¢Neck‰πãAFPNÔºàÂÖ®Êñ∞Ê∏êËøõÁâπÂæÅÈáëÂ≠óÂ°î|Ë∂ÖË∂äPAFPN|ÂÆûÊµãÊ∂®ÁÇπÔºâ][YOLOv5_18_Neck_AFPN_PAFPN]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà19Ôºâ‚Äî‚ÄîÊõøÊç¢‰∏ªÂπ≤ÁΩëÁªú‰πãSwin TransformerV1ÔºàÂèÇÊï∞ÈáèÊõ¥Â∞èÁöÑViTÊ®°ÂûãÔºâ][YOLOv5_19_Swin TransformerV1_ViT]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà20Ôºâ‚Äî‚ÄîÊ∑ªÂä†BiFormerÊ≥®ÊÑèÂäõÊú∫Âà∂ÔºàCVPR2023|Â∞èÁõÆÊ†áÊ∂®ÁÇπÁ•ûÂô®Ôºâ][YOLOv5_20_BiFormer_CVPR2023]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà21Ôºâ‚Äî‚ÄîÊõøÊç¢‰∏ªÂπ≤ÁΩëÁªú‰πãRepViTÔºàÊ∏ÖÂçé ICCV 2023|ÊúÄÊñ∞ÂºÄÊ∫êÁßªÂä®Á´ØViTÔºâ][YOLOv5_21_RepViT_ ICCV 2023_ViT]

[YOLOv5ÊîπËøõÁ≥ªÂàóÔºà22Ôºâ‚Äî‚ÄîÊõøÊç¢‰∏ªÂπ≤ÁΩëÁªú‰πãMobileViTv1Ôºà‰∏ÄÁßçËΩªÈáèÁ∫ßÁöÑ„ÄÅÈÄöÁî®ÁöÑÁßªÂä®ËÆæÂ§á ViTÔºâ][YOLOv5_22_MobileViTv1_ ViT][YOLOv5ÊîπËøõÁ≥ªÂàóÔºà23Ôºâ‚Äî‚ÄîÊõøÊç¢‰∏ªÂπ≤ÁΩëÁªú‰πãMobileViTv2ÔºàÁßªÂä®ËßÜËßâ Transformer ÁöÑÈ´òÊïàÂèØÂàÜÁ¶ªËá™Ê≥®ÊÑèÂäõÊú∫Âà∂Ôºâ][YOLOv5_23_MobileViTv2_ Transformer]

![](https://i-blog.csdnimg.cn/blog_migrate/f31479040dad120f2e7e1c099fd38a2b.gif)

ÁõÆÂΩï

[üöÄ‰∏Ä„ÄÅCBAMÊ≥®ÊÑèÂäõÊú∫Âà∂ÂéüÁêÜ][CBAM]

[1.1 CBAMÊñπÊ≥ï‰ªãÁªç][1.1 CBAM]

[1.2 ÈÄöÈÅìÊ≥®ÊÑèÂäõÊú∫Âà∂Ê®°ÂùóÔºàCAMÔºâ][1.2 _CAM]

[1.3 Á©∫Èó¥Ê≥®ÊÑèÂäõÊú∫Âà∂Ê®°ÂùóÔºàSAMÔºâ][1.3 _SAM]

[1.4 ÂÖ∑‰ΩìËøáÁ®ã][1.4]

[üöÄ‰∫å„ÄÅÊ∑ªÂä†CBAMÊ≥®ÊÑèÂäõÊú∫Âà∂ÊñπÊ≥ïÔºàÂçïÁã¨Âä†Ôºâ][CBAM 1]

[2.1 Ê∑ªÂä†È°∫Â∫è ][2.1 _]

[2.2 ÂÖ∑‰ΩìÊ∑ªÂä†Ê≠•È™§ ][2.2 _]

[Á¨¨‚ë†Ê≠•ÔºöÂú®common.py‰∏≠Ê∑ªÂä†CBAMÊ®°Âùó][common.py_CBAM]

[Á¨¨‚ë°Ê≠•ÔºöÂú®yolo.pyÊñá‰ª∂ÈáåÁöÑparse\_modelÂáΩÊï∞Âä†ÂÖ•Á±ªÂêç][yolo.py_parse_model]

[Á¨¨‚ë¢Ê≠•ÔºöÂàõÂª∫Ëá™ÂÆö‰πâÁöÑyamlÊñá‰ª∂ ][yaml_]

[Á¨¨‚ë£Ê≠•ÔºöÈ™åËØÅÊòØÂê¶Âä†ÂÖ•ÊàêÂäü][Link 1]

[Á¨¨‚ë§Ê≠•Ôºö‰øÆÊîπtrain.py‰∏≠ ‚Äò--cfg‚ÄôÈªòËÆ§ÂèÇÊï∞][train.py_ _--cfg]

[üöÄ‰∏â„ÄÅÊ∑ªÂä†C3\_CBAMÊ≥®ÊÑèÂäõÊú∫Âà∂ÊñπÊ≥ïÔºàÂú®C3Ê®°Âùó‰∏≠Ê∑ªÂä†Ôºâ][C3_CBAM_C3]

[Á¨¨‚ë†Ê≠•ÔºöÂú®common.py‰∏≠Ê∑ªÂä†CBAMBottleneckÂíåC3\_CBAMÊ®°Âùó][common.py_CBAMBottleneck_C3_CBAM]

[Á¨¨‚ë°Ê≠•ÔºöÂú®yolo.pyÊñá‰ª∂ÈáåÁöÑparse\_modelÂáΩÊï∞Âä†ÂÖ•Á±ªÂêç][yolo.py_parse_model]

[Á¨¨‚ë¢Ê≠•ÔºöÂàõÂª∫Ëá™ÂÆö‰πâÁöÑyamlÊñá‰ª∂ ][yaml_]

[Á¨¨‚ë£Ê≠•ÔºöÈ™åËØÅÊòØÂê¶Âä†ÂÖ•ÊàêÂäü][Link 1]

[Á¨¨‚ë§Ê≠•Ôºö‰øÆÊîπtrain.py‰∏≠ ‚Äò--cfg‚ÄôÈªòËÆ§ÂèÇÊï∞][train.py_ _--cfg]

[üåüÊú¨‰∫∫YOLOv5Á≥ªÂàóÂØºËà™][YOLOv5]

![](https://i-blog.csdnimg.cn/blog_migrate/abeb07169a1cbdca6da5bc7bcfd42c44.gif)

## üöÄ‰∏Ä„ÄÅCBAMÊ≥®ÊÑèÂäõÊú∫Âà∂ÂéüÁêÜ 

> ËÆ∫ÊñáÈ¢òÁõÆÔºö„ÄäCBAM: Convolutional Block Attention Module„Äã
> 
> ËÆ∫ÊñáÂú∞ÂùÄÔºö[https://arxiv.org/pdf/1807.06521.pdf][https_arxiv.org_pdf_1807.06521.pdf]
> 
> ‰ª£Á†ÅÂÆûÁé∞Ôºö[CBAM.PyTorch][]

![](https://i-blog.csdnimg.cn/blog_migrate/675d77544168d0f6310e2c530178c8be.png)

### 1.1 CBAMÊñπÊ≥ï‰ªãÁªç 

CBAMÊ≥®ÊÑèÂäõÊú∫Âà∂ÊòØÁî±ÈÄöÈÅìÊ≥®ÊÑèÂäõÊú∫Âà∂ÔºàchannelÔºâÂíåÁ©∫Èó¥Ê≥®ÊÑèÂäõÊú∫Âà∂ÔºàspatialÔºâÁªÑÊàê„ÄÇ

![](https://i-blog.csdnimg.cn/blog_migrate/27a9a5d99624a04be0882a868cbd46f8.png)

Âú®‰∏ä‰∏ÄÁØáÁöÑSE‰∏≠ÔºåÊàë‰ª¨Â≠¶‰π†‰∫ÜÈÄöÈÅìÊ≥®ÊÑèÂäõÊú∫Âà∂ÔºàchannelÔºâÔºåËÄåÊú¨ÁØáÁöÑCBAM‰ªéÈÄöÈÅìchannel Âíå Á©∫Èó¥spatial ‰∏§‰∏™‰ΩúÁî®ÂüüÂá∫ÂèëÔºåÂÆûÁé∞‰ªéÈÄöÈÅìÂà∞Á©∫Èó¥ÁöÑÈ°∫Â∫èÊ≥®ÊÑèÂäõÁªìÊûÑ„ÄÇÁ©∫Èó¥Ê≥®ÊÑèÂäõÂèØ‰ΩøÁ•ûÁªèÁΩëÁªúÊõ¥Âä†ÂÖ≥Ê≥®ÂõæÂÉè‰∏≠ÂØπÂàÜÁ±ªËµ∑ÂÜ≥ÂÆö‰ΩúÁî®ÁöÑÂÉèÁ¥†Âå∫ÂüüËÄåÂøΩÁï•Êó†ÂÖ≥Á¥ßË¶ÅÁöÑÂå∫ÂüüÔºåÈÄöÈÅìÊ≥®ÊÑèÂäõÂàôÁî®‰∫éÂ§ÑÁêÜÁâπÂæÅÂõæÈÄöÈÅìÁöÑÂàÜÈÖçÂÖ≥Á≥ªÔºåÂêåÊó∂ÂØπ‰∏§‰∏™Áª¥Â∫¶ËøõË°åÊ≥®ÊÑèÂäõÂàÜÈÖçÂ¢ûÂº∫‰∫ÜÊ≥®ÊÑèÂäõÊú∫Âà∂ÂØπÊ®°ÂûãÊÄßËÉΩÁöÑÊèêÂçáÊïàÊûú„ÄÇ

### 1.2 ÈÄöÈÅìÊ≥®ÊÑèÂäõÊú∫Âà∂Ê®°ÂùóÔºàCAMÔºâ 

![](https://i-blog.csdnimg.cn/blog_migrate/5813f5064eed4dddc0f75b21f58c56e8.png)

ÂÖ∑‰ΩìÊµÅÁ®ãÂ¶Ç‰∏ãÔºö  
È¶ñÂÖàÔºåÂ∞ÜËæìÂÖ•ÁöÑÁâπÂæÅÂõæFÔºàH√óW√óCÔºâÂàÜÂà´ÁªèËøáÂü∫‰∫éwidthÂíåheightÁöÑÊúÄÂ§ßÊ±†ÂåñÂíåÂπ≥ÂùáÊ±†ÂåñÔºåÂØπÁâπÂæÅÊò†Â∞ÑÂü∫‰∫é‰∏§‰∏™Áª¥Â∫¶ÂéãÁº©ÔºåÂæóÂà∞‰∏§‰∏™1√ó1√óCÁöÑÁâπÂæÅÂõæ

Êé•ÁùÄÔºåÂÜçÂ∞ÜÊúÄÂ§ßÊ±†ÂåñÂíåÂπ≥ÂùáÊ±†ÂåñÁöÑÁªìÊûúÂà©Áî®ÂÖ±‰∫´ÁöÑÂÖ®ËøûÊé•Â±ÇÔºàShared MLPÔºâËøõË°åÂ§ÑÁêÜÔºåÂÖàÈÄöËøá‰∏Ä‰∏™ÂÖ®ËøûÊé•Â±Ç‰∏ãÈôçÈÄöÈÅìÊï∞ÔºåÂÜçÈÄöËøáÂè¶‰∏Ä‰∏™ÂÖ®ËøûÊé•ÊÅ¢Â§çÈÄöÈÅìÊï∞„ÄÇ

ÁÑ∂ÂêéÔºåÂ∞ÜÂÖ±‰∫´ÁöÑÂÖ®ËøûÊé•Â±ÇÊâÄÂæóÂà∞ÁöÑÁªìÊûúËøõË°åÁõ∏Âä†ÂÜç‰ΩøÁî®SigmoidÊøÄÊ¥ªÂáΩÊï∞ÔºåËøõËÄåÁîüÊàêÊúÄÁªàÁöÑchannel attention featureÔºåÂç≥Ëé∑ÂæóËæìÂÖ•ÁâπÂæÅÂ±ÇÊØè‰∏Ä‰∏™ÈÄöÈÅìÁöÑÊùÉÈáçÔºà0~1‰πãÈó¥Ôºâ„ÄÇ

ÊúÄÂêéÔºåÂ∞ÜÊùÉÈáçÈÄöËøá‰πòÊ≥ïÈÄêÈÄöÈÅìÂä†ÊùÉÂà∞ËæìÂÖ•ÁâπÂæÅÂ±Ç‰∏äÔºåÁîüÊàêSpatial attentionÊ®°ÂùóÈúÄË¶ÅÁöÑËæìÂÖ•ÁâπÂæÅ„ÄÇ

‰ª£Á†ÅÂÆûÁé∞Â¶Ç‰∏ãÔºö 

```java
#Ôºà1ÔºâÈÄöÈÅìÊ≥®ÊÑèÂäõÊú∫Âà∂
class channel_attention(nn.Module):
    # ÂàùÂßãÂåñ, in_channel‰ª£Ë°®ËæìÂÖ•ÁâπÂæÅÂõæÁöÑÈÄöÈÅìÊï∞, ratio‰ª£Ë°®Á¨¨‰∏Ä‰∏™ÂÖ®ËøûÊé•ÁöÑÈÄöÈÅì‰∏ãÈôçÂÄçÊï∞
    def __init__(self, in_channel, ratio=4):
        # ÁªßÊâøÁà∂Á±ªÂàùÂßãÂåñÊñπÊ≥ï
        super(channel_attention, self).__init__()
        
        # ÂÖ®Â±ÄÊúÄÂ§ßÊ±†Âåñ [b,c,h,w]==>[b,c,1,1]
        self.max_pool = nn.AdaptiveMaxPool2d(output_size=1)
        # ÂÖ®Â±ÄÂπ≥ÂùáÊ±†Âåñ [b,c,h,w]==>[b,c,1,1]
        self.avg_pool = nn.AdaptiveAvgPool2d(output_size=1)
        
        # Á¨¨‰∏Ä‰∏™ÂÖ®ËøûÊé•Â±Ç, ÈÄöÈÅìÊï∞‰∏ãÈôç4ÂÄç
        self.fc1 = nn.Linear(in_features=in_channel, out_features=in_channel//ratio, bias=False)
        # Á¨¨‰∫å‰∏™ÂÖ®ËøûÊé•Â±Ç, ÊÅ¢Â§çÈÄöÈÅìÊï∞
        self.fc2 = nn.Linear(in_features=in_channel//ratio, out_features=in_channel, bias=False)
        
        # reluÊøÄÊ¥ªÂáΩÊï∞
        self.relu = nn.ReLU()
        # sigmoidÊøÄÊ¥ªÂáΩÊï∞
        self.sigmoid = nn.Sigmoid()
    
    # ÂâçÂêë‰º†Êí≠
    def forward(self, inputs):
        # Ëé∑ÂèñËæìÂÖ•ÁâπÂæÅÂõæÁöÑshape
        b, c, h, w = inputs.shape
        
        # ËæìÂÖ•ÂõæÂÉèÂÅöÂÖ®Â±ÄÊúÄÂ§ßÊ±†Âåñ [b,c,h,w]==>[b,c,1,1]
        max_pool = self.max_pool(inputs)
        # ËæìÂÖ•ÂõæÂÉèÁöÑÂÖ®Â±ÄÂπ≥ÂùáÊ±†Âåñ [b,c,h,w]==>[b,c,1,1]
        avg_pool = self.avg_pool(inputs)
 
        # Ë∞ÉÊï¥Ê±†ÂåñÁªìÊûúÁöÑÁª¥Â∫¶ [b,c,1,1]==>[b,c]
        max_pool = max_pool.view([b,c])
        avg_pool = avg_pool.view([b,c])
 
        # Á¨¨‰∏Ä‰∏™ÂÖ®ËøûÊé•Â±Ç‰∏ãÈôçÈÄöÈÅìÊï∞ [b,c]==>[b,c//4]
        x_maxpool = self.fc1(max_pool)
        x_avgpool = self.fc1(avg_pool)
 
        # ÊøÄÊ¥ªÂáΩÊï∞
        x_maxpool = self.relu(x_maxpool)
        x_avgpool = self.relu(x_avgpool)
        
        # Á¨¨‰∫å‰∏™ÂÖ®ËøûÊé•Â±ÇÊÅ¢Â§çÈÄöÈÅìÊï∞ [b,c//4]==>[b,c]
        x_maxpool = self.fc2(x_maxpool)
        x_avgpool = self.fc2(x_avgpool)
        
        # Â∞ÜËøô‰∏§ÁßçÊ±†ÂåñÁªìÊûúÁõ∏Âä† [b,c]==>[b,c]
        x = x_maxpool + x_avgpool
        # sigmoidÂáΩÊï∞ÊùÉÂÄºÂΩí‰∏ÄÂåñ
        x = self.sigmoid(x)
        # Ë∞ÉÊï¥Áª¥Â∫¶ [b,c]==>[b,c,1,1]
        x = x.view([b,c,1,1])
        # ËæìÂÖ•ÁâπÂæÅÂõæÂíåÈÄöÈÅìÊùÉÈáçÁõ∏‰πò [b,c,h,w]
        outputs = inputs * x
        
        return outputs
```

### 1.3 Á©∫Èó¥Ê≥®ÊÑèÂäõÊú∫Âà∂Ê®°ÂùóÔºàSAMÔºâ 

![](https://i-blog.csdnimg.cn/blog_migrate/a9fe32e0ab697d801e4c5d199c6c04eb.png)

ÂÖ∑‰ΩìÊµÅÁ®ãÂ¶Ç‰∏ãÔºö  
Â∞Ü‰∏äÈù¢CAMÊ®°ÂùóËæìÂá∫ÁöÑÁâπÂæÅÂõæF‚Äô‰Ωú‰∏∫Êú¨Ê®°ÂùóÁöÑËæìÂÖ•ÁâπÂæÅÂõæ„ÄÇ

È¶ñÂÖàÔºåÂØπËæìÂÖ•ÁâπÂæÅÂõæÂú®ÈÄöÈÅìÁª¥Â∫¶‰∏ãÂÅöÊúÄÂ§ßÊ±†ÂåñÂíåÂπ≥ÂùáÊ±†ÂåñÔºåÂ∞ÜÊ±†ÂåñÂêéÁöÑ‰∏§Âº†ÁâπÂæÅÂõæÂú®ÈÄöÈÅìÁª¥Â∫¶Â†ÜÂè†ÔºàconcatÔºâ„ÄÇ

ÁÑ∂ÂêéÔºåÁªèËøá‰∏Ä‰∏™7√ó7Âç∑ÁßØÔºà7√ó7ÊØî3√ó3ÊïàÊûúË¶ÅÂ•ΩÔºâÊìç‰ΩúÔºåÈôçÁª¥‰∏∫1‰∏™channelÔºåÂç≥Âç∑ÁßØÊ†∏ËûçÂêàÈÄöÈÅì‰ø°ÊÅØÔºåÁâπÂæÅÂõæÁöÑshape‰ªé \[b,2,h,w\] ÂèòÊàê \[b,1,h,w\]„ÄÇ

ÊúÄÂêéÔºåÂ∞ÜÂç∑ÁßØÂêéÁöÑÁªìÊûúÁªèËøá sigmoid ÂáΩÊï∞ÂØπÁâπÂæÅÂõæÁöÑÁ©∫Èó¥ÊùÉÈáçÂΩí‰∏ÄÂåñÔºåÂÜçÂ∞ÜËæìÂÖ•ÁâπÂæÅÂõæÂíåÊùÉÈáçÁõ∏‰πò„ÄÇ

‰ª£Á†ÅÂÆûÁé∞Â¶Ç‰∏ãÔºö 

```java
#Ôºà2ÔºâÁ©∫Èó¥Ê≥®ÊÑèÂäõÊú∫Âà∂
class spatial_attention(nn.Module):
    # ÂàùÂßãÂåñÔºåÂç∑ÁßØÊ†∏Â§ßÂ∞è‰∏∫7*7
    def __init__(self, kernel_size=7):
        # ÁªßÊâøÁà∂Á±ªÂàùÂßãÂåñÊñπÊ≥ï
        super(spatial_attention, self).__init__()
        
        # ‰∏∫‰∫Ü‰øùÊåÅÂç∑ÁßØÂâçÂêéÁöÑÁâπÂæÅÂõæshapeÁõ∏ÂêåÔºåÂç∑ÁßØÊó∂ÈúÄË¶Åpadding
        padding = kernel_size // 2
        # 7*7Âç∑ÁßØËûçÂêàÈÄöÈÅì‰ø°ÊÅØ [b,2,h,w]==>[b,1,h,w]
        self.conv = nn.Conv2d(in_channels=2, out_channels=1, kernel_size=kernel_size,
                              padding=padding, bias=False)
        # sigmoidÂáΩÊï∞
        self.sigmoid = nn.Sigmoid()
    
    # ÂâçÂêë‰º†Êí≠
    def forward(self, inputs):
        
        # Âú®ÈÄöÈÅìÁª¥Â∫¶‰∏äÊúÄÂ§ßÊ±†Âåñ [b,1,h,w]  keepdim‰øùÁïôÂéüÊúâÊ∑±Â∫¶
        # ËøîÂõûÂÄºÊòØÂú®ÊüêÁª¥Â∫¶ÁöÑÊúÄÂ§ßÂÄºÂíåÂØπÂ∫îÁöÑÁ¥¢Âºï
        x_maxpool, _ = torch.max(inputs, dim=1, keepdim=True)
        
        # Âú®ÈÄöÈÅìÁª¥Â∫¶‰∏äÂπ≥ÂùáÊ±†Âåñ [b,1,h,w]
        x_avgpool = torch.mean(inputs, dim=1, keepdim=True)
        # Ê±†ÂåñÂêéÁöÑÁªìÊûúÂú®ÈÄöÈÅìÁª¥Â∫¶‰∏äÂ†ÜÂè† [b,2,h,w]
        x = torch.cat([x_maxpool, x_avgpool], dim=1)
        
        # Âç∑ÁßØËûçÂêàÈÄöÈÅì‰ø°ÊÅØ [b,2,h,w]==>[b,1,h,w]
        x = self.conv(x)
        # Á©∫Èó¥ÊùÉÈáçÂΩí‰∏ÄÂåñ
        x = self.sigmoid(x)
        # ËæìÂÖ•ÁâπÂæÅÂõæÂíåÁ©∫Èó¥ÊùÉÈáçÁõ∏‰πò
        outputs = inputs * x
        
        return outputs
```

### 1.4 ÂÖ∑‰ΩìËøáÁ®ã 

CBAMÁöÑÊìç‰ΩúËøáÁ®ãÂàÜ‰∏∫CAMÂíåSAMÔºåÁªôÂá∫‰∏Ä‰∏™‰∏≠Èó¥ÁâπÂæÅÂõæ![F\in R^{C\times H\times W}](https://latex.csdn.net/eq?F%5Cin%20R%5E%7BC%5Ctimes%20H%5Ctimes%20W%7D)‰Ωú‰∏∫ËæìÂÖ•„ÄÇ

È¶ñÂÖàÔºåÂØπËæìÂÖ•ÈÄöÈÅìËøõË°åÂÖ®Â±ÄÊúÄÂ§ßÊ±†ÂåñÂíåÂÖ®Â±ÄÂπ≥ÂùáÊ±†ÂåñÔºåÂ∞ÜÊ±†ÂåñÂêéÁöÑ‰∏§‰∏™‰∏ÄÁª¥ÂêëÈáèËæìÂÖ•ÂÖ®ËøûÈÄöÂ±ÇÔºåÁõ∏Âä†ÁîüÊàê‰∏ÄÁª¥‰ø°ÈÅìÊ≥®ÊÑè![M_{c}\in R^{C\times H\times W}](https://latex.csdn.net/eq?M_%7Bc%7D%5Cin%20R%5E%7BC%5Ctimes%20H%5Ctimes%20W%7D)ÔºåÁÑ∂ÂêéÂ∞Ü‰ø°ÈÅìÊ≥®ÊÑè‰∏éËæìÂÖ•ÂÖÉÁ¥†Áõ∏‰πòÔºåÂæóÂà∞‰ø°ÈÅìÊ≥®ÊÑèË∞ÉÊï¥ÁâπÂæÅÂõæF‚Äô„ÄÇ

ÂÖ∂Ê¨°ÔºåFÊòØÁî±ÂÖ®ÁêÉÊúÄÂ§ßÂíåÂπ≥ÂùáÊ±†Á©∫Èó¥ÔºåÂíåÊ±†ÁîüÊàêÁöÑ‰∏§‰∏™‰∫åÁª¥ÂêëÈáèÊ±†ÊãºÊé•ÂíåÂç∑ÁßØÊúÄÁªàÁîüÊàê‰∫åÁª¥Á©∫Èó¥ÂÖ≥Ê≥®![M_{s}\in R^{C\times H\times W}](https://latex.csdn.net/eq?M_%7Bs%7D%5Cin%20R%5E%7BC%5Ctimes%20H%5Ctimes%20W%7D)ÔºåÂπ∂Â∞ÜÁ©∫Èó¥Ê≥®ÊÑèÂäõ‰∏éFÁöÑÂÖÉÁ¥†ÔºåÂ¶ÇÂõæ2ÊâÄÁ§∫„ÄÇÊ≥®ÊÑèËøáÁ®ãÂèØ‰ª•Áî®‰ª•‰∏ãÂÖ¨Âºè(1)ÂíåÂÖ¨Âºè(2)Êù•ÊèèËø∞„ÄÇ

![](https://i-blog.csdnimg.cn/blog_migrate/1450f33fad17b5167b01f81a9bf85197.png)

ÂÖ∂‰∏≠Ôºå‚äóË°®Á§∫ÂØπÂ∫îÁöÑÂÖÉÁ¥†‰πòÊ≥ïÔºåÂú®‰πòÊ≥ïÊìç‰ΩúÂâçÔºåÈúÄË¶ÅÂàÜÂà´Ê†πÊçÆÁ©∫Èó¥Áª¥Â∫¶Âíå‰ø°ÈÅìÁª¥Â∫¶Êù•ÂπøÊí≠‰ø°ÈÅìÊ≥®ÊÑèÂíåÁ©∫Èó¥Ê≥®ÊÑè„ÄÇÈÄöÈÅìÊ≥®ÊÑèÊñπÁ®ã‰∏∫Ôºö

![](https://i-blog.csdnimg.cn/blog_migrate/6fe5533fd7a4a0e10aacdc0b3683672a.png) Á©∫Èó¥Ê≥®ÊÑèÂ∫èÂàóÊòØÔºö

![](https://i-blog.csdnimg.cn/blog_migrate/5f0dd40ff74de691db9fe29ee23e981d.png)

CBAMÊ®°ÂùóÁªìÊûÑÂ¶Ç‰∏ãÔºö

![](https://i-blog.csdnimg.cn/blog_migrate/268c5686b879a94e05c005ab3a2bc41b.png)

## üöÄ‰∫å„ÄÅÊ∑ªÂä†CBAMÊ≥®ÊÑèÂäõÊú∫Âà∂ÊñπÊ≥ïÔºàÂçïÁã¨Âä†Ôºâ 

### 2.1 Ê∑ªÂä†È°∫Â∫è 

Ôºà1Ôºâmodels/common.py -->  Âä†ÂÖ•Êñ∞Â¢ûÁöÑÁΩëÁªúÁªìÊûÑ

Ôºà2Ôºâ models/yolo.py -->  ËÆæÂÆöÁΩëÁªúÁªìÊûÑÁöÑ‰º†ÂèÇÁªÜËäÇÔºåÂ∞ÜCBAMÁ±ªÂêçÂä†ÂÖ•ÂÖ∂‰∏≠„ÄÇÔºàÂΩìÊñ∞ÁöÑËá™ÂÆö‰πâÊ®°Âùó‰∏≠Â≠òÂú®ËæìÂÖ•ËæìÂá∫Áª¥Â∫¶Êó∂ÔºåË¶Å‰ΩøÁî®qwË∞ÉÊï¥ËæìÂá∫Áª¥Â∫¶Ôºâ  
Ôºà3Ôºâ models/yolov5\*.yaml -->  Êñ∞Âª∫‰∏Ä‰∏™Êñá‰ª∂Â§πÔºåÂ¶Çyolov5s\_CBAM.yamlÔºå‰øÆÊîπÁé∞ÊúâÊ®°ÂûãÁªìÊûÑÈÖçÁΩÆÊñá‰ª∂„ÄÇÔºàÂΩìÂºïÂÖ•Êñ∞ÁöÑÂ±ÇÊó∂ÔºåË¶Å‰øÆÊîπÂêéÁª≠ÁöÑÁªìÊûÑ‰∏≠ÁöÑfromÂèÇÊï∞Ôºâ  
Ôºà4Ôºâ train.py --> ‰øÆÊîπ‚Äò--cfg‚ÄôÈªòËÆ§ÂèÇÊï∞ÔºåËÆ≠ÁªÉÊó∂ÊåáÂÆöÊ®°ÂûãÁªìÊûÑÈÖçÁΩÆÊñá‰ª∂

### 2.2 ÂÖ∑‰ΩìÊ∑ªÂä†Ê≠•È™§ 

#### Á¨¨‚ë†Ê≠•ÔºöÂú®common.py‰∏≠Ê∑ªÂä†CBAMÊ®°Âùó 

Â∞Ü‰∏ãÈù¢ÁöÑCBAM‰ª£Á†ÅÂ§çÂà∂Á≤òË¥¥Âà∞common.pyÊñá‰ª∂ÁöÑÊú´Â∞æ

```java
# CBAM
class ChannelAttention(nn.Module):
    def __init__(self, in_planes, ratio=16):
        super(ChannelAttention, self).__init__()
        self.avg_pool = nn.AdaptiveAvgPool2d(1)
        self.max_pool = nn.AdaptiveMaxPool2d(1)
        self.f1 = nn.Conv2d(in_planes, in_planes // ratio, 1, bias=False)
        self.relu = nn.ReLU()
        self.f2 = nn.Conv2d(in_planes // ratio, in_planes, 1, bias=False)
        self.sigmoid = nn.Sigmoid()
    def forward(self, x):
        avg_out = self.f2(self.relu(self.f1(self.avg_pool(x))))
        max_out = self.f2(self.relu(self.f1(self.max_pool(x))))
        out = self.sigmoid(avg_out + max_out)
        return out
    
class SpatialAttention(nn.Module):
    def __init__(self, kernel_size=7):
        super(SpatialAttention, self).__init__()
        assert kernel_size in (3, 7), 'kernel size must be 3 or 7'
        padding = 3 if kernel_size == 7 else 1
        # (ÁâπÂæÅÂõæÁöÑÂ§ßÂ∞è-ÁÆóÂ≠êÁöÑsize+2*padding)/Ê≠•Èïø+1
        self.conv = nn.Conv2d(2, 1, kernel_size, padding=padding, bias=False)
        self.sigmoid = nn.Sigmoid()
    def forward(self, x):
        # 1*h*w
        avg_out = torch.mean(x, dim=1, keepdim=True)
        max_out, _ = torch.max(x, dim=1, keepdim=True)
        x = torch.cat([avg_out, max_out], dim=1)
        #2*h*w
        x = self.conv(x)
        #1*h*w
        return self.sigmoid(x)
    
class CBAM(nn.Module):
    def __init__(self, c1, c2, ratio=16, kernel_size=7):  # ch_in, ch_out, number, shortcut, groups, expansion
        super(CBAM, self).__init__()
        self.channel_attention = ChannelAttention(c1, ratio)
        self.spatial_attention = SpatialAttention(kernel_size)
    def forward(self, x):
        out = self.channel_attention(x) * x
        # c*h*w
        # c*h*w * 1*h*w
        out = self.spatial_attention(out) * out
        return out
```

Â¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö

![](https://i-blog.csdnimg.cn/blog_migrate/05b8402137670360357de4b386681edc.png)

#### Á¨¨‚ë°Ê≠•ÔºöÂú®yolo.pyÊñá‰ª∂ÈáåÁöÑparse\_modelÂáΩÊï∞Âä†ÂÖ•Á±ªÂêç 

È¶ñÂÖàÊâæÂà∞yolo.pyÈáåÈù¢parse\_modelÂáΩÊï∞ÁöÑËøô‰∏ÄË°å

![](https://i-blog.csdnimg.cn/blog_migrate/bba4391d0c7a836a6dd99b450002d847.png)

ÁÑ∂ÂêéÊääCBAMÊ∑ªÂä†Âà∞Ëøô‰∏™Ê≥®ÂÜåË°®ÈáåÈù¢

![](https://i-blog.csdnimg.cn/blog_migrate/1a42cbb90f324629f0c1dc4169c75780.png)

#### Á¨¨‚ë¢Ê≠•ÔºöÂàõÂª∫Ëá™ÂÆö‰πâÁöÑyamlÊñá‰ª∂ 

È¶ñÂÖàÂú®modelsÊñá‰ª∂Â§π‰∏ãÂ§çÂà∂yolov5s.yamlÊñá‰ª∂ÔºåÁ≤òË¥¥Âπ∂ÈáçÂëΩÂêç‰∏∫yolov5s\_CBAM.yaml

![](https://i-blog.csdnimg.cn/blog_migrate/d8dfc7c163e08da1fa05f806706f182c.png)

Êé•ÁùÄ‰øÆÊîπ yolov5s\_CBAM.yaml ÔºåÂ∞ÜCBAMÊ®°ÂùóÂä†Âà∞Êàë‰ª¨ÊÉ≥Ê∑ªÂä†ÁöÑ‰ΩçÁΩÆ„ÄÇ

Ê≥®ÊÑèÂäõÊú∫Âà∂ÂèØ‰ª•Ê∑ªÂä†Âú®backboneÔºåNeckÔºåHeadÁ≠âÈÉ®ÂàÜÔºå Â∏∏ËßÅÁöÑÊúâ‰∏§ÁßçÔºö‰∏ÄÊòØÂú®‰∏ªÂπ≤ÁöÑ SPPF ÂâçÊ∑ªÂä†‰∏ÄÂ±ÇÔºõ‰∫åÊòØÂ∞ÜBackbone‰∏≠ÁöÑC3ÂÖ®ÈÉ®ÊõøÊç¢„ÄÇ

Âú®ËøôÈáåÊàëÊòØÁî®Á¨¨‰∏ÄÁßçÔºöÂ∞Ü \[-1Ôºå1ÔºåCBAMÔºå\[1024\]\]Ê∑ªÂä†Âà∞ SPPF ÁöÑ‰∏ä‰∏ÄÂ±ÇÔºå‰∏ã‰∏ÄËäÇ‰ΩøÁî®Á¨¨‰∫åÁßç„ÄÇÂç≥‰∏ãÂõæ‰∏≠ÊâÄÁ§∫‰ΩçÁΩÆÔºö

![](https://i-blog.csdnimg.cn/blog_migrate/f751023d541a93941207d05845ba9464.png)

ÂêåÊ†∑ÁöÑ‰∏ãÈù¢ÁöÑhead‰πüÂæó‰øÆÊîπÔºåp4Ôºåp5‰ª•ÂèäÊúÄÂêédetectÁöÑÊÄªÂ±ÇÊï∞ÈÉΩÂæó+1

![](https://i-blog.csdnimg.cn/blog_migrate/78edc7ac33a500e4734c8d4c80ea8610.png)

ËøôÈáåÊàë‰ª¨Ë¶ÅÊääÂêéÈù¢‰∏§‰∏™ConcatÁöÑfromÁ≥ªÊï∞ÂàÜÂà´Áî±\[ ‚àí 1 , 14 \] , \[ ‚àí 1 , 10 \]Êîπ‰∏∫\[ ‚àí 1 , 15 \], \[ ‚àí 1 , 11 \]„ÄÇÁÑ∂ÂêéÂ∞ÜDetectÂéüÂßãÁöÑfromÁ≥ªÊï∞\[ 17 , 20 , 23 \]Ë¶ÅÊîπ‰∏∫\[ 18 , 21 , 24 \] „ÄÇ

![](https://i-blog.csdnimg.cn/blog_migrate/3fbb39efeb5b506a42408c36b2bffa33.png)

#### Á¨¨‚ë£Ê≠•ÔºöÈ™åËØÅÊòØÂê¶Âä†ÂÖ•ÊàêÂäü 

Âú®yolo.py Êñá‰ª∂ÈáåÈù¢ÈÖçÁΩÆÊîπ‰∏∫Êàë‰ª¨ÂàöÊâçËá™ÂÆö‰πâÁöÑyolov5s\_CBAM.yaml

![](https://i-blog.csdnimg.cn/blog_migrate/7f2d039f25b9ca2b32fb13b2446692a9.png)

![](https://i-blog.csdnimg.cn/blog_migrate/f3085b54899fbce1c877cb99f3d632e0.png)

ÁÑ∂ÂêéËøêË°åyolo.py

![](https://i-blog.csdnimg.cn/blog_migrate/cba02ebaa5f72e30fb01911cab64a169.png)

ÊâæÂà∞CBAMËøô‰∏ÄÂ±ÇÔºåÂ∞±ËØ¥ÊòéÊàë‰ª¨Ê∑ªÂä†ÊàêÂäüÂï¶ÔºÅ

#### Á¨¨‚ë§Ê≠•Ôºö‰øÆÊîπtrain.py‰∏≠ ‚Äò--cfg‚ÄôÈªòËÆ§ÂèÇÊï∞ 

Êàë‰ª¨ÂÖàÊâæÂà∞ train.py Êñá‰ª∂ÁöÑparse\_optÂáΩÊï∞ÔºåÁÑ∂ÂêéÂ∞ÜÁ¨¨‰∫åË°å‚Äò--cfg‚ÄôÁöÑdefaultÊîπ‰∏∫'models/yolov5s\_CBAM.yaml'ÔºåÁÑ∂ÂêéÂ∞±ÂèØ‰ª•ÂºÄÂßãËÆ≠ÁªÉÂï¶~

![](https://i-blog.csdnimg.cn/blog_migrate/69f7f3e6b2b6b381775c14587248c306.png)

## üöÄ‰∏â„ÄÅÊ∑ªÂä†C3\_CBAMÊ≥®ÊÑèÂäõÊú∫Âà∂ÊñπÊ≥ïÔºàÂú®C3Ê®°Âùó‰∏≠Ê∑ªÂä†Ôºâ 

‰∏äÈù¢ÊòØÂçïÁã¨Âä†Ê≥®ÊÑèÂäõÂ±ÇÔºåÊé•‰∏ãÊù•ÁöÑÊñπÊ≥ïÊòØÂú®C3Ê®°Âùó‰∏≠Âä†ÂÖ•Ê≥®ÊÑèÂäõÂ±Ç„ÄÇ

ÂàöÊâç‰πüÊèêÂà∞‰∫ÜÔºåËøô‰∏™Á≠ñÁï•ÊòØÂ∞ÜCBAMÊ≥®ÊÑèÂäõÊú∫Âà∂Ê∑ªÂä†Âà∞BottleneckÔºåÊõøÊç¢Backbone‰∏≠ÁöÑÊâÄÊúâC3Ê®°Âùó„ÄÇ

ÔºàÂõ†‰∏∫Ê≠•È™§Âíå‰∏äÈù¢Áõ∏ÂêåÔºåÊâÄ‰ª•Êé•‰∏ãÊù•Âè™ÊîæÈáçË¶ÅÊ≠•È™§Âô¢~Ôºâ

#### Á¨¨‚ë†Ê≠•ÔºöÂú®common.py‰∏≠Ê∑ªÂä†CBAMBottleneckÂíåC3\_CBAMÊ®°Âùó 

Â∞Ü‰∏ãÈù¢ÁöÑ‰ª£Á†ÅÂ§çÂà∂Á≤òË¥¥Âà∞common.pyÊñá‰ª∂ÁöÑÊú´Â∞æ

```java
# CBAM
class ChannelAttention(nn.Module):
    def __init__(self, in_planes, ratio=16):
        super(ChannelAttention, self).__init__()
        self.avg_pool = nn.AdaptiveAvgPool2d(1)
        self.max_pool = nn.AdaptiveMaxPool2d(1)
        self.f1 = nn.Conv2d(in_planes, in_planes // ratio, 1, bias=False)
        self.relu = nn.ReLU()
        self.f2 = nn.Conv2d(in_planes // ratio, in_planes, 1, bias=False)
        self.sigmoid = nn.Sigmoid()
    def forward(self, x):
        avg_out = self.f2(self.relu(self.f1(self.avg_pool(x))))
        max_out = self.f2(self.relu(self.f1(self.max_pool(x))))
        out = self.sigmoid(avg_out + max_out)
        return out
    
class SpatialAttention(nn.Module):
    def __init__(self, kernel_size=7):
        super(SpatialAttention, self).__init__()
        assert kernel_size in (3, 7), 'kernel size must be 3 or 7'
        padding = 3 if kernel_size == 7 else 1
        # (ÁâπÂæÅÂõæÁöÑÂ§ßÂ∞è-ÁÆóÂ≠êÁöÑsize+2*padding)/Ê≠•Èïø+1
        self.conv = nn.Conv2d(2, 1, kernel_size, padding=padding, bias=False)
        self.sigmoid = nn.Sigmoid()
    def forward(self, x):
        # 1*h*w
        avg_out = torch.mean(x, dim=1, keepdim=True)
        max_out, _ = torch.max(x, dim=1, keepdim=True)
        x = torch.cat([avg_out, max_out], dim=1)
        #2*h*w
        x = self.conv(x)
        #1*h*w
        return self.sigmoid(x)

class CBAMBottleneck(nn.Module):
    # ch_in, ch_out, shortcut, groups, expansion, ratio, kernel_size
    def __init__(self, c1, c2, shortcut=True, g=1, e=0.5, ratio=16, kernel_size=7):
        super(CBAMBottleneck, self).__init__()
        c_ = int(c2 * e)  # hidden channels
        self.cv1 = Conv(c1, c_, 1, 1)
        self.cv2 = Conv(c_, c2, 3, 1, g=g)
        self.add = shortcut and c1 == c2
        # Âä†ÂÖ•CBAMÊ®°Âùó
        self.channel_attention = ChannelAttention(c2, ratio)
        self.spatial_attention = SpatialAttention(kernel_size)
    
    def forward(self, x):
        # ËÄÉËôëÂä†ÂÖ•CBAMÊ®°ÂùóÁöÑ‰ΩçÁΩÆÔºöbottleneckÊ®°ÂùóÂàöÂºÄÂßãÊó∂„ÄÅbottleneckÊ®°Âùó‰∏≠shortcut‰πãÂâçÔºåËøôÈáåÈÄâÊã©Âú®shortcut‰πãÂâç
        x2 = self.cv2(self.cv1(x))  # xÂíåx2ÁöÑchannelÊï∞Áõ∏Âêå
        # Âú®bottleneckÊ®°Âùó‰∏≠shortcut‰πãÂâçÂä†ÂÖ•CBAMÊ®°Âùó
        out = self.channel_attention(x2) * x2
        # print('outchannels:{}'.format(out.shape))
        out = self.spatial_attention(out) * out
        return x + out if self.add else out


class C3_CBAM(C3):
    # C3 module with CBAMBottleneck()
    def __init__(self, c1, c2, n=1, shortcut=True, g=1, e=0.5):
        super().__init__(c1, c2, n, shortcut, g, e)
        c_ = int(c2 * e)  # hidden channels
        self.m = nn.Sequential(*(CBAMBottleneck(c_, c_, shortcut, g, e=1.0) for _ in range(n)))
```

#### Á¨¨‚ë°Ê≠•ÔºöÂú®yolo.pyÊñá‰ª∂ÈáåÁöÑparse\_modelÂáΩÊï∞Âä†ÂÖ•Á±ªÂêç 

Âú®yolo.pyÁöÑ`parse_model`ÂáΩÊï∞‰∏≠ÔºåÂä†ÂÖ•`CBAMBottleneck, C3_CBAMËøô`‰∏§‰∏™Ê®°Âùó

![](https://i-blog.csdnimg.cn/blog_migrate/3ca1537acc57c12373e16b67d2466ded.png)

#### Á¨¨‚ë¢Ê≠•ÔºöÂàõÂª∫Ëá™ÂÆö‰πâÁöÑyamlÊñá‰ª∂ 

ÊåâÁÖß‰∏äÈù¢ÁöÑÊ≠•È™§ÂàõÂª∫yolov5s\_C3\_CBAM.yamlÊñá‰ª∂ÔºåÊõøÊç¢4‰∏™C3Ê®°Âùó

![](https://i-blog.csdnimg.cn/blog_migrate/9516dd68cb81d344addedb667b61749a.png)

```java
# YOLOv5 üöÄ by Ultralytics, GPL-3.0 license

# Parameters
nc: 80  # number of classes
depth_multiple: 0.33  # model depth multiple
width_multiple: 0.50  # layer channel multiple
anchors:
  - [10,13, 16,30, 33,23]  # P3/8
  - [30,61, 62,45, 59,119]  # P4/16
  - [116,90, 156,198, 373,326]  # P5/32

# YOLOv5 v6.0 backbone
backbone:
  # [from, number, module, args]
  [[-1, 1, Conv, [64, 6, 2, 2]],  # 0-P1/2
   [-1, 1, Conv, [128, 3, 2]],  # 1-P2/4
   [-1, 3, C3_CBAM, [128]],
   [-1, 1, Conv, [256, 3, 2]],  # 3-P3/8
   [-1, 6, C3_CBAM, [256]],
   [-1, 1, Conv, [512, 3, 2]],  # 5-P4/16
   [-1, 3, C3_CBAM, [512]],
   [-1, 1, Conv, [1024, 3, 2]],  # 7-P5/32
   [-1, 3, C3_CBAM, [1024]],
   [-1, 1, SPPF, [1024, 5]],  # 9
  ]

# YOLOv5 v6.0 head
head:
  [[-1, 1, Conv, [512, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 6], 1, Concat, [1]],  # cat backbone P4
   [-1, 3, C3, [512, False]],  # 13

   [-1, 1, Conv, [256, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 4], 1, Concat, [1]],  # cat backbone P3
   [-1, 3, C3, [256, False]],  # 17 (P3/8-small)

   [-1, 1, Conv, [256, 3, 2]],
   [[-1, 14], 1, Concat, [1]],  # cat head P4
   [-1, 3, C3, [512, False]],  # 20 (P4/16-medium)

   [-1, 1, Conv, [512, 3, 2]],
   [[-1, 10], 1, Concat, [1]],  # cat head P5
   [-1, 3, C3, [1024, False]],  # 23 (P5/32-large)

   [[17, 20, 23], 1, Detect, [nc, anchors]],  # Detect(P3, P4, P5)
  ]
```

#### Á¨¨‚ë£Ê≠•ÔºöÈ™åËØÅÊòØÂê¶Âä†ÂÖ•ÊàêÂäü 

Âú®yolo.py Êñá‰ª∂ÈáåÈù¢ÈÖçÁΩÆÊîπ‰∏∫Êàë‰ª¨ÂàöÊâçËá™ÂÆö‰πâÁöÑyolov5s\_C3\_CBAM.yamlÔºåÁÑ∂ÂêéËøêË°å

![](https://i-blog.csdnimg.cn/blog_migrate/e8235c49e950016d0f200a85cbbaae1e.png)

ËøôÊ†∑Â∞±OKÂï¶~

#### Á¨¨‚ë§Ê≠•Ôºö‰øÆÊîπtrain.py‰∏≠ ‚Äò--cfg‚ÄôÈªòËÆ§ÂèÇÊï∞ 

Êé•‰∏ãÊù•ÁöÑËÆ≠ÁªÉÂ∞±Âíå‰∏äÈù¢‰∏ÄÊ†∑Ôºå‰∏çÂÜçÂèôËø∞Âï¶~

ÂÆåÁªì~ÊííËä±‚úø‚úø„ÉΩ(¬∞‚ñΩ¬∞)„Éé‚úø

PSÔºöÂä†ÂÖ•‰∏çÂêåÁöÑ‰ΩçÁΩÆÊïàÊûú‰∏çÂêåÔºåËøô‰∏§‰∏™ÊàëÂêÑËÆ≠ÁªÉ100ËΩÆÁúã‰∫Ü‰∏ãÊïàÊûúÔºåÂØπ‰∫éÊàëÁöÑÊï∞ÊçÆÈõÜÊù•ËØ¥ÔºåÁ¨¨2ÁßçÊØîÁ¨¨1ÁßçmAPÂ¢ûÂä†0.009„ÄÇ

## üåüÊú¨‰∫∫YOLOv5Á≥ªÂàóÂØºËà™ 

![962f7cb1b48f44e29d9beb1d499d0530.gif](https://i-blog.csdnimg.cn/blog_migrate/ac3c5d6bfbcbf982e8e9e3632d7f20d1.gif) üçÄ[YOLOv5Ê∫êÁ†Å][YOLOv5 1]ËØ¶Ëß£Á≥ªÂàóÔºö

[YOLOv5Ê∫êÁ†ÅÈÄêË°åË∂ÖËØ¶ÁªÜÊ≥®Èáä‰∏éËß£ËØªÔºà1Ôºâ‚Äî‚ÄîÈ°πÁõÆÁõÆÂΩïÁªìÊûÑËß£Êûê][YOLOv5_1]

[YOLOv5Ê∫êÁ†ÅÈÄêË°åË∂ÖËØ¶ÁªÜÊ≥®Èáä‰∏éËß£ËØªÔºà2Ôºâ‚Äî‚ÄîÊé®ÁêÜÈÉ®ÂàÜdetect.py][YOLOv5_2_detect.py]

[YOLOv5Ê∫êÁ†ÅÈÄêË°åË∂ÖËØ¶ÁªÜÊ≥®Èáä‰∏éËß£ËØªÔºà3Ôºâ‚Äî‚ÄîËÆ≠ÁªÉÈÉ®ÂàÜtrain.py][YOLOv5_3_train.py]

[YOLOv5Ê∫êÁ†ÅÈÄêË°åË∂ÖËØ¶ÁªÜÊ≥®Èáä‰∏éËß£ËØªÔºà4Ôºâ‚Äî‚ÄîÈ™åËØÅÈÉ®ÂàÜvalÔºàtestÔºâ.py][YOLOv5_4_val_test_.py]

[YOLOv5Ê∫êÁ†ÅÈÄêË°åË∂ÖËØ¶ÁªÜÊ≥®Èáä‰∏éËß£ËØªÔºà5Ôºâ‚Äî‚ÄîÈÖçÁΩÆÊñá‰ª∂yolov5s.yaml][YOLOv5_5_yolov5s.yaml]

[YOLOv5Ê∫êÁ†ÅÈÄêË°åË∂ÖËØ¶ÁªÜÊ≥®Èáä‰∏éËß£ËØªÔºà6Ôºâ‚Äî‚ÄîÁΩëÁªúÁªìÊûÑÔºà1Ôºâyolo.py][YOLOv5_6_1_yolo.py]

[YOLOv5Ê∫êÁ†ÅÈÄêË°åË∂ÖËØ¶ÁªÜÊ≥®Èáä‰∏éËß£ËØªÔºà7Ôºâ‚Äî‚ÄîÁΩëÁªúÁªìÊûÑÔºà2Ôºâcommon.py][YOLOv5_7_2_common.py]

![962f7cb1b48f44e29d9beb1d499d0530.gif](https://i-blog.csdnimg.cn/blog_migrate/ac3c5d6bfbcbf982e8e9e3632d7f20d1.gif) üçÄ[YOLOv5ÂÖ•Èó®ÂÆûË∑µ][YOLOv5 1]Á≥ªÂàóÔºö

[YOLOv5ÂÖ•Èó®ÂÆûË∑µÔºà1Ôºâ‚Äî‚ÄîÊâãÊääÊâãÂ∏¶‰Ω†ÁéØÂ¢ÉÈÖçÁΩÆÊê≠Âª∫][YOLOv5_1 1]

[YOLOv5ÂÖ•Èó®ÂÆûË∑µÔºà2Ôºâ‚Äî‚ÄîÊâãÊääÊâãÊïô‰Ω†Âà©Áî®labelimgÊ†áÊ≥®Êï∞ÊçÆÈõÜ][YOLOv5_2_labelimg]

[YOLOv5ÂÖ•Èó®ÂÆûË∑µÔºà3Ôºâ‚Äî‚ÄîÊâãÊääÊâãÊïô‰Ω†ÂàíÂàÜËá™Â∑±ÁöÑÊï∞ÊçÆÈõÜ][YOLOv5_3]

[YOLOv5ÂÖ•Èó®ÂÆûË∑µÔºà4Ôºâ‚Äî‚ÄîÊâãÊääÊâãÊïô‰Ω†ËÆ≠ÁªÉËá™Â∑±ÁöÑÊï∞ÊçÆÈõÜ][YOLOv5_4]

[YOLOv5ÂÖ•Èó®ÂÆûË∑µÔºà5Ôºâ‚Äî‚Äî‰ªéÈõ∂ÂºÄÂßãÔºåÊâãÊääÊâãÊïô‰Ω†ËÆ≠ÁªÉËá™Â∑±ÁöÑÁõÆÊ†áÊ£ÄÊµãÊ®°ÂûãÔºàÂåÖÂê´pyqt5ÁïåÈù¢Ôºâ][YOLOv5_5_pyqt5]

> Êú¨ÊñáÂèÇËÄÉÔºàÊÑüË∞¢Â§ß‰Ω¨‰ª¨ÔºâÔºö
> 
> bÁ´ôÔºö[„ÄêYOLOv5 v6.1Ê∑ªÂä†SE,CA,CBAM,ECAÊ≥®ÊÑèÂäõÊú∫Âà∂ÊïôÂ≠¶ÔºåÂç≥ÊèíÂç≥Áî®„Äë][YOLOv5 v6.1_SE_CA_CBAM_ECA]
> 
> CSDNÔºö [„ÄêÊ∑±Â∫¶Â≠¶‰π†„Äë(1) CNN‰∏≠ÁöÑÊ≥®ÊÑèÂäõÊú∫Âà∂ÔºàSE„ÄÅECA„ÄÅCBAMÔºâ\_Á´ãSirÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢][1_ CNN_SE_ECA_CBAM_Sir_-CSDN]
> 
> [(Âº∫Êé®) ÊâãÊääÊâãÂ∏¶‰Ω†YOLOv5 (v6.1)Ê∑ªÂä†Ê≥®ÊÑèÂäõÊú∫Âà∂(‰∫å)ÔºàÂú®C3Ê®°Âùó‰∏≠Âä†ÂÖ•Ê≥®ÊÑèÂäõÊú∫Âà∂Ôºâ\_Ëø™Ëè≤Ëµ´Â∞îÊõºÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢][_YOLOv5 _v6.1_C3_-CSDN]

![](https://i-blog.csdnimg.cn/blog_migrate/2a94f52802c04e1a86599e33518ad91d.gif)


[YOLOv5_0]: https://blog.csdn.net/weixin_43334693/article/details/130564848?spm=1001.2014.3001.5501
[YOLOv5_1_SE]: https://blog.csdn.net/weixin_43334693/article/details/130551913?spm=1001.2014.3001.5501
[YOLOv5_3_CA]: https://blog.csdn.net/weixin_43334693/article/details/130619604?spm=1001.2014.3001.5501
[YOLOv5_4_ECA]: https://blog.csdn.net/weixin_43334693/article/details/130641318?spm=1001.2014.3001.5501
[YOLOv5_5_ MobileNetV3]: https://blog.csdn.net/weixin_43334693/article/details/130832933?spm=1001.2014.3001.5501
[YOLOv5_6_ ShuffleNetV2]: https://blog.csdn.net/weixin_43334693/article/details/131008642?spm=1001.2014.3001.5501
[YOLOv5_7_SimAM]: https://blog.csdn.net/weixin_43334693/article/details/131031541?spm=1001.2014.3001.5501
[YOLOv5_8_SOCA]: https://blog.csdn.net/weixin_43334693/article/details/131053284?spm=1001.2014.3001.5501
[YOLOv5_9_EfficientNetv2]: https://blog.csdn.net/weixin_43334693/article/details/131207097?csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22article%22%2C%22rId%22%3A%22131207097%22%2C%22source%22%3A%22weixin_43334693%22%7D
[YOLOv5_10_GhostNet]: https://blog.csdn.net/weixin_43334693/article/details/131235113?spm=1001.2014.3001.5501
[YOLOv5_11_EIoU_AlphaIoU_SIoU_WIoU]: https://blog.csdn.net/weixin_43334693/article/details/131350224?spm=1001.2014.3001.5501
[YOLOv5_12_Neck_BiFPN]: https://blog.csdn.net/weixin_43334693/article/details/131461294?spm=1001.2014.3001.5501
[YOLOv5_13_SiLU_ReLU_ELU_Hardswish_Mish_Softplus_AconC]: https://blog.csdn.net/weixin_43334693/article/details/131513850?spm=1001.2014.3001.5502
[YOLOv5_14_NMS_ DIoU-NMS_CIoU-NMS_EIoU-NMS_GIoU-NMS _SIoU-NMS_Soft-NMS]: https://blog.csdn.net/weixin_43334693/article/details/131552028?spm=1001.2014.3001.5501
[YOLOv5_15]: https://blog.csdn.net/weixin_43334693/article/details/131613721?spm=1001.2014.3001.5502
[YOLOv5_16_EMA_ICASSP2023]: https://blog.csdn.net/weixin_43334693/article/details/131973273?spm=1001.2014.3001.5501
[YOLOv5_17_IoU_MPDIoU_ELSEVIER 2023_WIoU_EIoU]: https://blog.csdn.net/weixin_43334693/article/details/131999141?spm=1001.2014.3001.5501
[YOLOv5_18_Neck_AFPN_PAFPN]: https://blog.csdn.net/weixin_43334693/article/details/132070079?spm=1001.2014.3001.5501
[YOLOv5_19_Swin TransformerV1_ViT]: https://blog.csdn.net/weixin_43334693/article/details/132161488?spm=1001.2014.3001.5501
[YOLOv5_20_BiFormer_CVPR2023]: https://blog.csdn.net/weixin_43334693/article/details/132203200?spm=1001.2014.3001.5502
[YOLOv5_21_RepViT_ ICCV 2023_ViT]: https://blog.csdn.net/weixin_43334693/article/details/132211831?spm=1001.2014.3001.5501
[YOLOv5_22_MobileViTv1_ ViT]: https://blog.csdn.net/weixin_43334693/article/details/132367429?csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22article%22%2C%22rId%22%3A%22132367429%22%2C%22source%22%3A%22weixin_43334693%22%7D
[YOLOv5_23_MobileViTv2_ Transformer]: https://blog.csdn.net/weixin_43334693/article/details/132428203?spm=1001.2014.3001.5501
[CBAM]: #%F0%9F%9A%80%E4%B8%80%E3%80%81CBAM%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E5%8E%9F%E7%90%86
[1.1 CBAM]: #1.1%20CBAM%E6%96%B9%E6%B3%95%E4%BB%8B%E7%BB%8D
[1.2 _CAM]: #1.2%C2%A0%E9%80%9A%E9%81%93%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E6%A8%A1%E5%9D%97%EF%BC%88CAM%EF%BC%89
[1.3 _SAM]: #1.3%C2%A0%E7%A9%BA%E9%97%B4%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E6%A8%A1%E5%9D%97%EF%BC%88SAM%EF%BC%89
[1.4]: #1.4%20%E5%85%B7%E4%BD%93%E8%BF%87%E7%A8%8B
[CBAM 1]: #%F0%9F%9A%80%E4%BA%8C%E3%80%81%E6%B7%BB%E5%8A%A0CBAM%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E6%96%B9%E6%B3%95%EF%BC%88%E5%8D%95%E7%8B%AC%E5%8A%A0%EF%BC%89
[2.1 _]: #2.1%20%E6%B7%BB%E5%8A%A0%E9%A1%BA%E5%BA%8F%C2%A0
[2.2 _]: #2.2%20%E5%85%B7%E4%BD%93%E6%B7%BB%E5%8A%A0%E6%AD%A5%E9%AA%A4%C2%A0
[common.py_CBAM]: #%E7%AC%AC%E2%91%A0%E6%AD%A5%EF%BC%9A%E5%9C%A8common.py%E4%B8%AD%E6%B7%BB%E5%8A%A0SE%E6%A8%A1%E5%9D%97
[yolo.py_parse_model]: #%E7%AC%AC%E2%91%A1%E6%AD%A5%EF%BC%9A%E5%9C%A8yolo.py%E6%96%87%E4%BB%B6%E9%87%8C%E7%9A%84parse_model%E5%87%BD%E6%95%B0%E5%8A%A0%E5%85%A5%E7%B1%BB%E5%90%8D
[yaml_]: #%E7%AC%AC%E2%91%A2%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84yaml%E6%96%87%E4%BB%B6%C2%A0
[Link 1]: #%E7%AC%AC%E2%91%A3%E6%AD%A5%EF%BC%9A%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E5%8A%A0%E5%85%A5%E6%88%90%E5%8A%9F
[train.py_ _--cfg]: #%E7%AC%AC%E2%91%A4%E6%AD%A5%EF%BC%9A%E4%BF%AE%E6%94%B9train.py%E4%B8%AD%C2%A0%E2%80%98--cfg%E2%80%99%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0
[C3_CBAM_C3]: #%C2%A0%F0%9F%9A%80%E4%B8%89%E3%80%81%E6%B7%BB%E5%8A%A0C3_CBAM%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E6%96%B9%E6%B3%95%EF%BC%88%E5%9C%A8C3%E6%A8%A1%E5%9D%97%E4%B8%AD%E6%B7%BB%E5%8A%A0%EF%BC%89
[common.py_CBAMBottleneck_C3_CBAM]: #%E7%AC%AC%E2%91%A0%E6%AD%A5%EF%BC%9A%E5%9C%A8common.py%E4%B8%AD%E6%B7%BB%E5%8A%A0CBAMBottleneck%E5%92%8CC3_CBAM%E6%A8%A1%E5%9D%97
[YOLOv5]: #%F0%9F%8C%9F%E6%9C%AC%E4%BA%BAYOLOv5%E7%B3%BB%E5%88%97%E5%AF%BC%E8%88%AA
[https_arxiv.org_pdf_1807.06521.pdf]: https://arxiv.org/pdf/1807.06521.pdf
[CBAM.PyTorch]: https://github.com/luuuyi/CBAM.PyTorch
[YOLOv5 1]: https://so.csdn.net/so/search?q=YOLOv5%E6%BA%90%E7%A0%81&spm=1001.2101.3001.7020
[YOLOv5_1]: https://blog.csdn.net/weixin_43334693/article/details/129356033?spm=1001.2014.3001.5501
[YOLOv5_2_detect.py]: https://blog.csdn.net/weixin_43334693/article/details/129349094?spm=1001.2014.3001.5501
[YOLOv5_3_train.py]: https://blog.csdn.net/weixin_43334693/article/details/129460666?spm=1001.2014.3001.5501
[YOLOv5_4_val_test_.py]: https://blog.csdn.net/weixin_43334693/article/details/129649553?spm=1001.2014.3001.5501
[YOLOv5_5_yolov5s.yaml]: https://blog.csdn.net/weixin_43334693/article/details/129697521?spm=1001.2014.3001.5501
[YOLOv5_6_1_yolo.py]: https://blog.csdn.net/weixin_43334693/article/details/129803802?spm=1001.2014.3001.5501
[YOLOv5_7_2_common.py]: https://blog.csdn.net/weixin_43334693/article/details/129854764?spm=1001.2014.3001.5501
[YOLOv5_1 1]: https://blog.csdn.net/weixin_43334693/article/details/129981848?spm=1001.2014.3001.5501
[YOLOv5_2_labelimg]: https://blog.csdn.net/weixin_43334693/article/details/129995604?spm=1001.2014.3001.5501
[YOLOv5_3]: https://blog.csdn.net/weixin_43334693/article/details/130025866?spm=1001.2014.3001.5501
[YOLOv5_4]: https://blog.csdn.net/weixin_43334693/article/details/130043351?spm=1001.2014.3001.5501
[YOLOv5_5_pyqt5]: https://blog.csdn.net/weixin_43334693/article/details/130044342?spm=1001.2014.3001.5501
[YOLOv5 v6.1_SE_CA_CBAM_ECA]: /https://www.bilibili.com/video/BV1kS4y1c7Bm?vd_source=725f2b2a52500df1eaed63206ebe0ab2
[1_ CNN_SE_ECA_CBAM_Sir_-CSDN]: https://blog.csdn.net/dgvv4/article/details/125112972?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168350459816800225558052%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=168350459816800225558052&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-5-125112972-null-null.142%5Ev86%5Ekoosearch_v1,239%5Ev2%5Einsert_chatgpt&utm_term=%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6&spm=1018.2226.3001.4187
[_YOLOv5 _v6.1_C3_-CSDN]: https://blog.csdn.net/weixin_43694096/article/details/124695537?csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22article%22%2C%22rId%22%3A%22124695537%22%2C%22source%22%3A%22weixin_43694096%22%7D