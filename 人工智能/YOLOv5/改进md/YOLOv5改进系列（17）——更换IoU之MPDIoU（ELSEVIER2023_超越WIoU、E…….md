![](https://i-blog.csdnimg.cn/blog_migrate/a735e2917bf8f53de525c55be5a0a512.gif)

![](https://i-blog.csdnimg.cn/blog_migrate/cba5712f3cc13abdcc15ac751fae103a.png)

![962f7cb1b48f44e29d9beb1d499d0530.gif](https://i-blog.csdnimg.cn/blog_migrate/ac3c5d6bfbcbf982e8e9e3632d7f20d1.gif)ã€YOLOv5æ”¹è¿›ç³»åˆ—ã€‘å‰æœŸå›é¡¾ï¼š

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ0ï¼‰â€”â€”é‡è¦æ€§èƒ½æŒ‡æ ‡ä¸è®­ç»ƒç»“æœè¯„ä»·åŠåˆ†æ][YOLOv5_0]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ1ï¼‰â€”â€”æ·»åŠ SEæ³¨æ„åŠ›æœºåˆ¶][YOLOv5_1_SE]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ2ï¼‰â€”â€”æ·»åŠ CBAMæ³¨æ„åŠ›æœºåˆ¶][YOLOv5_2_CBAM]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ3ï¼‰â€”â€”æ·»åŠ CAæ³¨æ„åŠ›æœºåˆ¶][YOLOv5_3_CA]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ4ï¼‰â€”â€”æ·»åŠ ECAæ³¨æ„åŠ›æœºåˆ¶][YOLOv5_4_ECA]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ5ï¼‰â€”â€”æ›¿æ¢ä¸»å¹²ç½‘ç»œä¹‹ MobileNetV3][YOLOv5_5_ MobileNetV3]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ6ï¼‰â€”â€”æ›¿æ¢ä¸»å¹²ç½‘ç»œä¹‹ ShuffleNetV2][YOLOv5_6_ ShuffleNetV2]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ7ï¼‰â€”â€”æ·»åŠ SimAMæ³¨æ„åŠ›æœºåˆ¶][YOLOv5_7_SimAM]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ8ï¼‰â€”â€”æ·»åŠ SOCAæ³¨æ„åŠ›æœºåˆ¶][YOLOv5_8_SOCA]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ9ï¼‰â€”â€”æ›¿æ¢ä¸»å¹²ç½‘ç»œä¹‹EfficientNetv2][YOLOv5_9_EfficientNetv2]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ10ï¼‰â€”â€”æ›¿æ¢ä¸»å¹²ç½‘ç»œä¹‹GhostNet][YOLOv5_10_GhostNet]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ11ï¼‰â€”â€”æ·»åŠ æŸå¤±å‡½æ•°ä¹‹EIoUã€AlphaIoUã€SIoUã€WIoU][YOLOv5_11_EIoU_AlphaIoU_SIoU_WIoU]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ12ï¼‰â€”â€”æ›´æ¢Neckä¹‹BiFPN][YOLOv5_12_Neck_BiFPN]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ13ï¼‰â€”â€”æ›´æ¢æ¿€æ´»å‡½æ•°ä¹‹SiLUï¼ŒReLUï¼ŒELUï¼ŒHardswishï¼ŒMishï¼ŒSoftplusï¼ŒAconCç³»åˆ—ç­‰][YOLOv5_13_SiLU_ReLU_ELU_Hardswish_Mish_Softplus_AconC]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ14ï¼‰â€”â€”æ›´æ¢NMSï¼ˆéæå¤§æŠ‘åˆ¶ï¼‰ä¹‹ DIoU-NMSã€CIoU-NMSã€EIoU-NMSã€GIoU-NMS ã€SIoU-NMSã€Soft-NMS][YOLOv5_14_NMS_ DIoU-NMS_CIoU-NMS_EIoU-NMS_GIoU-NMS _SIoU-NMS_Soft-NMS]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ15ï¼‰â€”â€”å¢åŠ å°ç›®æ ‡æ£€æµ‹å±‚][YOLOv5_15]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ16ï¼‰â€”â€”æ·»åŠ EMAæ³¨æ„åŠ›æœºåˆ¶ï¼ˆICASSP2023|å®æµ‹æ¶¨ç‚¹ï¼‰][YOLOv5_16_EMA_ICASSP2023]

![](https://i-blog.csdnimg.cn/blog_migrate/3d0a0a91e7a91cef9cbf6b7245bd6108.gif)

ç›®å½•

[ğŸš€ä¸€ã€MPDIoUä»‹ç» ][MPDIoU_]

[1.1 ç®€ä»‹][1.1]

[1.2 æœ€å°ç‚¹è·ç¦»äº¤å¹¶æ¯”][1.2]

[1.3 MPDIoUçš„æŸå¤±å‡½æ•°][1.3 MPDIoU]

[1.4 å®éªŒ][1.4]

[ğŸš€äºŒã€æ›´æ¢MPDIoUæ–¹æ³•][MPDIoU]

[ç¬¬â‘ æ­¥ é…ç½®metric.pyæ–‡ä»¶][_metric.py]

[ç¬¬â‘¡æ­¥ é…ç½®loss.pyæ–‡ä»¶][_loss.py]

[ğŸŒŸæœ¬äººYOLOv5ç³»åˆ—å¯¼èˆª][YOLOv5]

![](https://i-blog.csdnimg.cn/blog_migrate/9a4331f1f372c604cb4d5ef25e8cb26d.gif)

## ğŸš€ä¸€ã€MPDIoUä»‹ç» 

>  *  è®ºæ–‡é¢˜ç›®ï¼šã€ŠMPDIoU: A Loss for Efficient and Accurate Bounding Box Regressionã€‹
>  *  åŸæ–‡åœ°å€ï¼š[arxiv.org/pdf/2307.07662v1.pdf][arxiv.org_pdf_2307.07662v1.pdf]

### ![](https://i-blog.csdnimg.cn/blog_migrate/aef262906d69374479c71e6f64956f9c.png)1.1 ç®€ä»‹ 

åœ¨ç›®æ ‡æ£€æµ‹ä»»åŠ¡ä¸­ï¼ŒæŸå¤±å‡½æ•°ç»å¸¸ç”¨äºåº¦é‡ç¥ç»ç½‘ç»œé¢„æµ‹ä¿¡æ¯ä¸æœŸæœ›æ ‡ç­¾çš„è·ç¦»ï¼Œé¢„æµ‹ä¿¡æ¯è¶Šæ¥è¿‘æœŸæœ›ä¿¡æ¯ï¼ŒæŸå¤±å‡½æ•°å€¼è¶Šå°ã€‚åœ¨YOLOç³»åˆ—ä½¿ç”¨CIoUï¼ŒCIoU åæ˜ é•¿å®½æ¯”çš„ä¸åŒï¼Œè€Œä¸æ˜¯é•¿å®½ä½ç½®ä¸ç½®ä¿¡åº¦ä¹‹é—´å­˜åœ¨çš„å®é™…å·®è·ï¼Œè¿™å°±ä¼šåœ¨æ£€æµ‹è¿‡ç¨‹ä¸­äº§ç”Ÿä¸€å®šçš„é—®é¢˜ã€‚

å¦‚å›¾8ï¼ˆaï¼‰æ‰€ç¤ºï¼Œå›¾ä¸­å¤–æ¡†ä¸ºå®é™…æ£€æµ‹æ¡†ï¼Œå†…æ¡†ä¸ºé¢„æµ‹æ¡†ï¼Œå½“ä¸­å¿ƒç‚¹é‡åˆé•¿å®½æ¯”ä¸€è‡´æ—¶ï¼ŒCIoUå°±ä¼šå¤±æ•ˆã€‚å¦å¤–å¦‚å›¾8ï¼ˆbï¼‰æ‰€ç¤ºï¼Œåœ¨å¤šä¸ªé¢„æµ‹æ¡†å¤§é¢ç§¯é‡å çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½åæ˜ å‡ºå®é™…æƒ…å†µã€‚

![](https://i-blog.csdnimg.cn/blog_migrate/53f389e29431e0021115d2a495727934.png)

ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œä½œè€…å……åˆ†æ¢ç´¢äº†æ°´å¹³çŸ©å½¢çš„å‡ ä½•ç‰¹å¾ï¼Œæå‡ºäº†ä¸€ç§åŸºäºæœ€å°ç‚¹è·ç¦»çš„è¾¹ç•Œæ¡†ç›¸ä¼¼åº¦æ¯”è¾ƒåº¦é‡â€”â€”MPDIoUï¼Œå…¶ä¸­åŒ…å«äº†ç°æœ‰æŸå¤±å‡½æ•°ä¸­è€ƒè™‘çš„æ‰€æœ‰ç›¸å…³å› ç´ ï¼Œä¾‹å¦‚é‡å æˆ–éé‡å é¢ç§¯ã€ä¸­å¿ƒç‚¹è·ç¦»ä»¥åŠå®½åº¦å’Œé«˜åº¦çš„åå·®ï¼ŒåŒæ—¶ç®€åŒ–äº†è®¡ç®—è¿‡ç¨‹ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œä½œè€…æå‡ºäº†ä¸€ç§åŸºäºMPDIoUçš„è¾¹ç•Œæ¡†å›å½’æŸå¤±å‡½æ•°ï¼Œç§°ä¸ºMLPDIoUã€‚

å®éªŒç»“æœè¡¨æ˜ï¼Œå°†MPDIoUæŸå¤±å‡½æ•°åº”ç”¨äºæœ€å…ˆè¿›çš„å®ä¾‹åˆ†å‰²ï¼ˆå¦‚YOLACTï¼‰å’Œç›®æ ‡æ£€æµ‹ï¼ˆå¦‚YOLOv7ï¼‰æ¨¡å‹ï¼Œåœ¨PASCAL VOCã€MS COCOå’ŒIIIT5kæ•°æ®é›†ä¸Šä¼˜äºç°æœ‰çš„æŸå¤±å‡½æ•°ã€‚

### 1.2 æœ€å°ç‚¹è·ç¦»äº¤å¹¶æ¯” 

ä½œè€…è®¾è®¡äº†ä¸€ç§æ–°é¢–çš„åŸºäºäº¤å¹¶æ¯”çš„åº¦é‡æ ‡å‡†ï¼Œåä¸ºMPDIoUï¼Œç›´æ¥æœ€å°åŒ–é¢„æµ‹è¾¹ç•Œæ¡†ä¸å®é™…æ ‡æ³¨è¾¹ç•Œæ¡†ä¹‹é—´çš„å·¦ä¸Šè§’å’Œå³ä¸‹è§’ç‚¹è·ç¦»ã€‚

è¯¥æ–¹æ³•ç›´æ¥æœ€å°åŒ–é¢„æµ‹è¾¹ç•Œæ¡†ä¸å®é™…æ ‡æ³¨è¾¹ç•Œæ¡†ä¹‹é—´çš„å·¦ä¸Šè§’å’Œå³ä¸‹è§’ç‚¹è·ç¦»ã€‚åœ¨è®­ç»ƒé˜¶æ®µï¼Œé€šè¿‡å…¬å¼è¿«ä½¿æ¨¡å‹é¢„æµ‹çš„æ¯ä¸ªè¾¹ç•Œæ¡†![B^{prd}=[x^{prd},y^{prd},w^{prd},h^{prd}]^{T}](https://latex.csdn.net/eq?B%5E%7Bprd%7D%3D%5Bx%5E%7Bprd%7D%2Cy%5E%7Bprd%7D%2Cw%5E%7Bprd%7D%2Ch%5E%7Bprd%7D%5D%5E%7BT%7D)æ¥è¿‘å…¶å®é™…è¾¹ç•Œæ¡†![B_{gt}=[x_{gt},y_{gt},w_{gt},h_{gt}]^{T}](https://latex.csdn.net/eq?B_%7Bgt%7D%3D%5Bx_%7Bgt%7D%2Cy_%7Bgt%7D%2Cw_%7Bgt%7D%2Ch_%7Bgt%7D%5D%5E%7BT%7D)ï¼š

![](https://i-blog.csdnimg.cn/blog_migrate/641ecb2fef9310f5e7bf83710ac34198.png)

å…¶ä¸­ï¼Œ![B_{gt}](https://latex.csdn.net/eq?B_%7Bgt%7D)æ˜¯å®é™…è¾¹ç•Œæ¡†çš„é›†åˆï¼Œ![\Theta](https://latex.csdn.net/eq?%5CTheta)æ˜¯ç”¨äºå›å½’çš„æ·±åº¦æ¨¡å‹çš„å‚æ•°ã€‚![L](https://latex.csdn.net/eq?L)çš„å…¸å‹å½¢å¼æ˜¯![L_{n}-norm](https://latex.csdn.net/eq?L_%7Bn%7D-norm)

MPDIoUçš„è®¡ç®—è¿‡ç¨‹æ€»ç»“åœ¨ç®—æ³•1ä¸­ï¼š

![27c14de8a52c96f1e096d04934f81185.png](https://i-blog.csdnimg.cn/blog_migrate/bf211fe9f252b5f723948fe4415fd697.png)

æ€»ç»“ä¸€ä¸‹ï¼š

1.  æå‡ºçš„MPDIoUç®€åŒ–äº†ä¸¤ä¸ªè¾¹ç•Œæ¡†ä¹‹é—´çš„ç›¸ä¼¼æ€§æ¯”è¾ƒ
2.  é€‚ç”¨äºé‡å æˆ–éé‡å çš„è¾¹ç•Œæ¡†å›å½’

å› æ­¤ï¼Œåœ¨2D/3Dè®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¸­ï¼ŒMPDIoUå¯ä»¥å¾ˆå¥½åœ°æ›¿ä»£äº¤å¹¶æ¯”ä½œä¸ºæ‰€æœ‰æ€§èƒ½æŒ‡æ ‡çš„åº¦é‡ã€‚

### 1.3 MPDIoUçš„æŸå¤±å‡½æ•° 

MPDIoUçš„æŸå¤±å‡½æ•°å…¬å¼å¦‚ä¸‹ï¼š

![](https://i-blog.csdnimg.cn/blog_migrate/0dd77b8472917d1b52ec8b5ef3d55d0b.png)

å› æ­¤ï¼Œç°æœ‰è¾¹ç•Œæ¡†å›å½’æŸå¤±å‡½æ•°çš„æ‰€æœ‰å› ç´ éƒ½å¯ä»¥é€šè¿‡4ä¸ªç‚¹çš„åæ ‡æ¥ç¡®å®šã€‚

è½¬æ¢å…¬å¼å¦‚ä¸‹æ‰€ç¤ºï¼š

![c9457256d91005c2e0a706fbb3a4aac3.png](https://i-blog.csdnimg.cn/blog_migrate/5687e92940e6d0059e51b159d60eced9.png)

ï¼ˆå…¬å¼è§£è¯»å¤§å®¶è‡ªå·±çœ‹åŸæ–‡æˆ–æ˜¯åˆ«çš„å¤§ä½¬è§£è¯»å§ï¼Œæ•°å­¦ç™½ç—´å…ˆè¡Œå‘Šé€€...orzï¼‰

### 1.4 å®éªŒ 

ï¼ˆ1ï¼‰ç›®æ ‡æ£€æµ‹çš„å®éªŒ

![](https://i-blog.csdnimg.cn/blog_migrate/b87e5f3ea390ac5c1922a9f96f64fceb.png)

ï¼ˆ2ï¼‰å­—ç¬¦çº§åœºæ™¯æ–‡æœ¬å®šä½çš„å®éªŒ

![](https://i-blog.csdnimg.cn/blog_migrate/57048f11695f52859a14b9da90e55c85.png)

ï¼ˆ3ï¼‰å®ä¾‹åˆ†å‰²çš„å®éªŒç»“æœ

![](https://i-blog.csdnimg.cn/blog_migrate/14e87e05626bc9d61947944f1f821694.png)

## ğŸš€äºŒã€æ›´æ¢MPDIoUæ–¹æ³• 

#### ç¬¬â‘ æ­¥ é…ç½®metric.pyæ–‡ä»¶ 

é¦–å…ˆæ‰¾åˆ° utils/metrics.py æ–‡ä»¶å¤¹ä¸‹çš„ bbox\_iou å‡½æ•°ï¼Œç„¶åå°†å‡½æ•°æ•´ä¸ªæ›¿æ¢æˆä¸‹é¢çš„ä»£ç ï¼š

```java
def bbox_iou(box1, box2, xywh=True, GIoU=False, DIoU=False, CIoU=False, SIoU=False, EIoU=False, WIoU=False, Focal=False,
              MPDIoU=False, alpha=1, gamma=0.5, scale=False, eps=1e-7):
    # Returns Intersection over Union (IoU) of box1(1,4) to box2(n,4)

    # Get the coordinates of bounding boxes
    if xywh:  # transform from xywh to xyxy
        (x1, y1, w1, h1), (x2, y2, w2, h2) = box1.chunk(4, -1), box2.chunk(4, -1)
        w1_, h1_, w2_, h2_ = w1 / 2, h1 / 2, w2 / 2, h2 / 2
        b1_x1, b1_x2, b1_y1, b1_y2 = x1 - w1_, x1 + w1_, y1 - h1_, y1 + h1_
        b2_x1, b2_x2, b2_y1, b2_y2 = x2 - w2_, x2 + w2_, y2 - h2_, y2 + h2_
    else:  # x1, y1, x2, y2 = box1
        b1_x1, b1_y1, b1_x2, b1_y2 = box1.chunk(4, -1)
        b2_x1, b2_y1, b2_x2, b2_y2 = box2.chunk(4, -1)
        w1, h1 = b1_x2 - b1_x1, (b1_y2 - b1_y1).clamp(eps)
        w2, h2 = b2_x2 - b2_x1, (b2_y2 - b2_y1).clamp(eps)

    # Intersection area
    inter = (b1_x2.minimum(b2_x2) - b1_x1.maximum(b2_x1)).clamp(0) * \
            (b1_y2.minimum(b2_y2) - b1_y1.maximum(b2_y1)).clamp(0)

    # Union Area
    union = w1 * h1 + w2 * h2 - inter + eps
    if scale:
        self = WIoU_Scale(1 - (inter / union))

    # IoU
    # iou = inter / union # ori iou
    iou = torch.pow(inter / (union + eps), alpha)  # alpha iou
    if CIoU or DIoU or GIoU or EIoU or SIoU or WIoU or MPDIoU:
        cw = b1_x2.maximum(b2_x2) - b1_x1.minimum(b2_x1)  # convex (smallest enclosing box) width
        ch = b1_y2.maximum(b2_y2) - b1_y1.minimum(b2_y1)  # convex height
        if CIoU or DIoU or EIoU or SIoU or WIoU or MPDIoU:  # Distance or Complete IoU https://arxiv.org/abs/1911.08287v1
            c2 = (cw ** 2 + ch ** 2) ** alpha + eps  # convex diagonal squared
            rho2 = (((b2_x1 + b2_x2 - b1_x1 - b1_x2) ** 2 + (
                        b2_y1 + b2_y2 - b1_y1 - b1_y2) ** 2) / 4) ** alpha  # center dist ** 2
            if CIoU:  # https://github.com/Zzh-tju/DIoU-SSD-pytorch/blob/master/utils/box/box_utils.py#L47
                v = (4 / math.pi ** 2) * (torch.atan(w2 / h2) - torch.atan(w1 / h1)).pow(2)
                with torch.no_grad():
                    alpha_ciou = v / (v - iou + (1 + eps))
                if Focal:
                    return iou - (rho2 / c2 + torch.pow(v * alpha_ciou + eps, alpha)), torch.pow(inter / (union + eps),
                                                                                                 gamma)  # Focal_CIoU
                else:
                    return iou - (rho2 / c2 + torch.pow(v * alpha_ciou + eps, alpha))  # CIoU
            elif EIoU:
                rho_w2 = ((b2_x2 - b2_x1) - (b1_x2 - b1_x1)) ** 2
                rho_h2 = ((b2_y2 - b2_y1) - (b1_y2 - b1_y1)) ** 2
                cw2 = torch.pow(cw ** 2 + eps, alpha)
                ch2 = torch.pow(ch ** 2 + eps, alpha)
                if Focal:
                    return iou - (rho2 / c2 + rho_w2 / cw2 + rho_h2 / ch2), torch.pow(inter / (union + eps),
                                                                                      gamma)  # Focal_EIou
                else:
                    return iou - (rho2 / c2 + rho_w2 / cw2 + rho_h2 / ch2)  # EIou
            elif MPDIoU:
                cw2 = torch.pow(cw ** 2 + eps, alpha)
                ch2 = torch.pow(ch ** 2 + eps, alpha)
                d12 = ((b2_x1 - b1_x1) - (b2_y1 - b1_y1)) ** 2
                d22 = ((b2_x2 - b1_x2) - (b2_y2 - b1_y2)) ** 2
                return iou - ((d12+d22)/(cw2+ ch2))
            elif SIoU:
                # SIoU Loss https://arxiv.org/pdf/2205.12740.pdf
                s_cw = (b2_x1 + b2_x2 - b1_x1 - b1_x2) * 0.5 + eps
                s_ch = (b2_y1 + b2_y2 - b1_y1 - b1_y2) * 0.5 + eps
                sigma = torch.pow(s_cw ** 2 + s_ch ** 2, 0.5)
                sin_alpha_1 = torch.abs(s_cw) / sigma
                sin_alpha_2 = torch.abs(s_ch) / sigma
                threshold = pow(2, 0.5) / 2
                sin_alpha = torch.where(sin_alpha_1 > threshold, sin_alpha_2, sin_alpha_1)
                angle_cost = torch.cos(torch.arcsin(sin_alpha) * 2 - math.pi / 2)
                rho_x = (s_cw / cw) ** 2
                rho_y = (s_ch / ch) ** 2
                gamma = angle_cost - 2
                distance_cost = 2 - torch.exp(gamma * rho_x) - torch.exp(gamma * rho_y)
                omiga_w = torch.abs(w1 - w2) / torch.max(w1, w2)
                omiga_h = torch.abs(h1 - h2) / torch.max(h1, h2)
                shape_cost = torch.pow(1 - torch.exp(-1 * omiga_w), 4) + torch.pow(1 - torch.exp(-1 * omiga_h), 4)
                if Focal:
                    return iou - torch.pow(0.5 * (distance_cost + shape_cost) + eps, alpha), torch.pow(
                        inter / (union + eps), gamma)  # Focal_SIou
                else:
                    return iou - torch.pow(0.5 * (distance_cost + shape_cost) + eps, alpha)  # SIou
            elif WIoU:
                if Focal:
                    raise RuntimeError("WIoU do not support Focal.")
                elif scale:
                    return getattr(WIoU_Scale, '_scaled_loss')(self), (1 - iou) * torch.exp(
                        (rho2 / c2)), iou  # WIoU https://arxiv.org/abs/2301.10051
                else:
                    return iou, torch.exp((rho2 / c2))  # WIoU v1
            if Focal:
                return iou - rho2 / c2, torch.pow(inter / (union + eps), gamma)  # Focal_DIoU
            else:
                return iou - rho2 / c2  # DIoU
        c_area = cw * ch + eps  # convex area
        if Focal:
            return iou - torch.pow((c_area - union) / c_area + eps, alpha), torch.pow(inter / (union + eps),
                                                                                      gamma)  # Focal_GIoU https://arxiv.org/pdf/1902.09630.pdf
        else:
            return iou - torch.pow((c_area - union) / c_area + eps, alpha)  # GIoU https://arxiv.org/pdf/1902.09630.pdf
    if Focal:
        return iou, torch.pow(inter / (union + eps), gamma)  # Focal_IoU
    else:
        return iou  # IoU
class WIoU_Scale:
    ''' monotonous: {
            None: origin v1
            True: monotonic FM v2
            False: non-monotonic FM v3
        }
        momentum: The momentum of running mean'''

    iou_mean = 1.
    monotonous = False
    _momentum = 1 - 0.5 ** (1 / 7000)
    _is_train = True

    def __init__(self, iou):
        self.iou = iou
        self._update(self)

    @classmethod
    def _update(cls, self):
        if cls._is_train: cls.iou_mean = (1 - cls._momentum) * cls.iou_mean + \
                                         cls._momentum * self.iou.detach().mean().item()

    @classmethod
    def _scaled_loss(cls, self, gamma=1.9, delta=3):
        if isinstance(self.monotonous, bool):
            if self.monotonous:
                return (self.iou.detach() / self.iou_mean).sqrt()
            else:
                beta = self.iou.detach() / self.iou_mean
                alpha = delta * torch.pow(gamma, beta - delta)
                return beta / alpha
        return 1
```

#### ç¬¬â‘¡æ­¥ é…ç½®loss.pyæ–‡ä»¶ 

ç„¶åå†æ‰¾åˆ° utils/loss.pyæ–‡ä»¶å¤¹ä¸‹çš„ \_\_call\_\_å‡½æ•°ï¼ŒæŠŠRegression lossä¸­è®¡ç®—IoUçš„ä»£ç ï¼Œæ¢æˆä¸‹é¢è¿™å¥ï¼š

```java
iou = bbox_iou(pbox, tbox[i], MPDIoU=True, scale=True)
                if type(iou) is tuple:
                    if len(iou) == 2:
                        lbox += (iou[1].detach().squeeze() * (1 - iou[0].squeeze())).mean()
                        iou = iou[0].squeeze()
                    else:
                        lbox += (iou[0] * iou[1]).mean()
                        iou = iou[2].squeeze()
                else:
                    lbox += (1.0 - iou.squeeze()).mean()  # iou loss
                    iou = iou.squeeze()
```

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://i-blog.csdnimg.cn/blog_migrate/db4b528cab9523470f915fd0322d6d5a.png)

![](https://i-blog.csdnimg.cn/blog_migrate/aa438630a4186ff2e7c4d8bb6edae98c.png)

å°±é…±~

> ä»£ç å‚è€ƒï¼š
> 
> [æŸå¤±å‡½æ•°ç¯‡ | YOLOv8 æ›´æ¢æŸå¤±å‡½æ•°ä¹‹ MPDIoU | ã€Š2023 ä¸€ç§ç”¨äºé«˜æ•ˆå‡†ç¡®çš„è¾¹ç•Œæ¡†å›å½’çš„æŸå¤±å‡½æ•°ã€‹\_è¿ªè²èµ«å°”æ›¼çš„åšå®¢-CSDNåšå®¢][_ YOLOv8 _ MPDIoU _ _2023 _-CSDN]

PSï¼š

åœ¨æˆ‘çš„æ•°æ®é›†ä¸Šï¼ŒMPDIoUæ¯”WIoUæ¶¨äº†0.9ï¼Œæ•ˆæœè¿˜æ˜¯ä¸é”™çš„~

WIoUï¼š

![](https://i-blog.csdnimg.cn/blog_migrate/691026f1a960fa1d2f68d428100bc40c.png)

MPDIoUï¼š

![](https://i-blog.csdnimg.cn/blog_migrate/8cb13aeb4cbe8746a6087e677a12c767.png)

## ğŸŒŸæœ¬äººYOLOv5ç³»åˆ—å¯¼èˆª 

![962f7cb1b48f44e29d9beb1d499d0530.gif](https://i-blog.csdnimg.cn/blog_migrate/ac3c5d6bfbcbf982e8e9e3632d7f20d1.gif) ğŸ€[YOLOv5æºç ][YOLOv5 1]è¯¦è§£ç³»åˆ—ï¼š

[YOLOv5æºç é€è¡Œè¶…è¯¦ç»†æ³¨é‡Šä¸è§£è¯»ï¼ˆ1ï¼‰â€”â€”é¡¹ç›®ç›®å½•ç»“æ„è§£æ][YOLOv5_1]

[YOLOv5æºç é€è¡Œè¶…è¯¦ç»†æ³¨é‡Šä¸è§£è¯»ï¼ˆ2ï¼‰â€”â€”æ¨ç†éƒ¨åˆ†detect.py][YOLOv5_2_detect.py]

[YOLOv5æºç é€è¡Œè¶…è¯¦ç»†æ³¨é‡Šä¸è§£è¯»ï¼ˆ3ï¼‰â€”â€”è®­ç»ƒéƒ¨åˆ†train.py][YOLOv5_3_train.py]

[YOLOv5æºç é€è¡Œè¶…è¯¦ç»†æ³¨é‡Šä¸è§£è¯»ï¼ˆ4ï¼‰â€”â€”éªŒè¯éƒ¨åˆ†valï¼ˆtestï¼‰.py][YOLOv5_4_val_test_.py]

[YOLOv5æºç é€è¡Œè¶…è¯¦ç»†æ³¨é‡Šä¸è§£è¯»ï¼ˆ5ï¼‰â€”â€”é…ç½®æ–‡ä»¶yolov5s.yaml][YOLOv5_5_yolov5s.yaml]

[YOLOv5æºç é€è¡Œè¶…è¯¦ç»†æ³¨é‡Šä¸è§£è¯»ï¼ˆ6ï¼‰â€”â€”ç½‘ç»œç»“æ„ï¼ˆ1ï¼‰yolo.py][YOLOv5_6_1_yolo.py]

[YOLOv5æºç é€è¡Œè¶…è¯¦ç»†æ³¨é‡Šä¸è§£è¯»ï¼ˆ7ï¼‰â€”â€”ç½‘ç»œç»“æ„ï¼ˆ2ï¼‰common.py][YOLOv5_7_2_common.py]

![962f7cb1b48f44e29d9beb1d499d0530.gif](https://i-blog.csdnimg.cn/blog_migrate/ac3c5d6bfbcbf982e8e9e3632d7f20d1.gif) ğŸ€[YOLOv5å…¥é—¨å®è·µ][YOLOv5 1]ç³»åˆ—ï¼š

[YOLOv5å…¥é—¨å®è·µï¼ˆ1ï¼‰â€”â€”æ‰‹æŠŠæ‰‹å¸¦ä½ ç¯å¢ƒé…ç½®æ­å»º][YOLOv5_1 1]

[YOLOv5å…¥é—¨å®è·µï¼ˆ2ï¼‰â€”â€”æ‰‹æŠŠæ‰‹æ•™ä½ åˆ©ç”¨labelimgæ ‡æ³¨æ•°æ®é›†][YOLOv5_2_labelimg]

[YOLOv5å…¥é—¨å®è·µï¼ˆ3ï¼‰â€”â€”æ‰‹æŠŠæ‰‹æ•™ä½ åˆ’åˆ†è‡ªå·±çš„æ•°æ®é›†][YOLOv5_3]

[YOLOv5å…¥é—¨å®è·µï¼ˆ4ï¼‰â€”â€”æ‰‹æŠŠæ‰‹æ•™ä½ è®­ç»ƒè‡ªå·±çš„æ•°æ®é›†][YOLOv5_4]

[YOLOv5å…¥é—¨å®è·µï¼ˆ5ï¼‰â€”â€”ä»é›¶å¼€å§‹ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ è®­ç»ƒè‡ªå·±çš„ç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼ˆåŒ…å«pyqt5ç•Œé¢ï¼‰][YOLOv5_5_pyqt5]

![](https://i-blog.csdnimg.cn/blog_migrate/2fdc8395aad28a713580831d1cfa0f0b.gif)


[YOLOv5_0]: https://blog.csdn.net/weixin_43334693/article/details/130564848?spm=1001.2014.3001.5501
[YOLOv5_1_SE]: https://blog.csdn.net/weixin_43334693/article/details/130551913?spm=1001.2014.3001.5501
[YOLOv5_2_CBAM]: https://blog.csdn.net/weixin_43334693/article/details/130587102?spm=1001.2014.3001.5501
[YOLOv5_3_CA]: https://blog.csdn.net/weixin_43334693/article/details/130619604?spm=1001.2014.3001.5501
[YOLOv5_4_ECA]: https://blog.csdn.net/weixin_43334693/article/details/130641318?spm=1001.2014.3001.5501
[YOLOv5_5_ MobileNetV3]: https://blog.csdn.net/weixin_43334693/article/details/130832933?spm=1001.2014.3001.5501
[YOLOv5_6_ ShuffleNetV2]: https://blog.csdn.net/weixin_43334693/article/details/131008642?spm=1001.2014.3001.5501
[YOLOv5_7_SimAM]: https://blog.csdn.net/weixin_43334693/article/details/131031541?spm=1001.2014.3001.5501
[YOLOv5_8_SOCA]: https://blog.csdn.net/weixin_43334693/article/details/131053284?spm=1001.2014.3001.5501
[YOLOv5_9_EfficientNetv2]: https://blog.csdn.net/weixin_43334693/article/details/131207097?csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22article%22%2C%22rId%22%3A%22131207097%22%2C%22source%22%3A%22weixin_43334693%22%7D
[YOLOv5_10_GhostNet]: https://blog.csdn.net/weixin_43334693/article/details/131235113?spm=1001.2014.3001.5501
[YOLOv5_11_EIoU_AlphaIoU_SIoU_WIoU]: https://blog.csdn.net/weixin_43334693/article/details/131350224?spm=1001.2014.3001.5501
[YOLOv5_12_Neck_BiFPN]: https://blog.csdn.net/weixin_43334693/article/details/131461294?spm=1001.2014.3001.5501
[YOLOv5_13_SiLU_ReLU_ELU_Hardswish_Mish_Softplus_AconC]: https://blog.csdn.net/weixin_43334693/article/details/131513850?spm=1001.2014.3001.5502
[YOLOv5_14_NMS_ DIoU-NMS_CIoU-NMS_EIoU-NMS_GIoU-NMS _SIoU-NMS_Soft-NMS]: https://blog.csdn.net/weixin_43334693/article/details/131552028?spm=1001.2014.3001.5501
[YOLOv5_15]: https://blog.csdn.net/weixin_43334693/article/details/131613721?spm=1001.2014.3001.5502
[YOLOv5_16_EMA_ICASSP2023]: https://blog.csdn.net/weixin_43334693/article/details/131973273?spm=1001.2014.3001.5501
[MPDIoU_]: #%F0%9F%9A%80%E4%B8%80%E3%80%81MPDIoU%E4%BB%8B%E7%BB%8D%C2%A0
[1.1]: #%E2%80%8B%E7%BC%96%E8%BE%911.1%20%E7%AE%80%E4%BB%8B
[1.2]: #1.2%20%E6%9C%80%E5%B0%8F%E7%82%B9%E8%B7%9D%E7%A6%BB%E4%BA%A4%E5%B9%B6%E6%AF%94
[1.3 MPDIoU]: #1.3%20MPDIoU%E7%9A%84%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0
[1.4]: #1.4%20%E5%AE%9E%E9%AA%8C
[MPDIoU]: #%F0%9F%9A%80%E4%BA%8C%E3%80%81%E5%9C%A8backbone%E6%9C%AB%E7%AB%AF%E6%B7%BB%E5%8A%A0SimAM%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E6%96%B9%E6%B3%95
[_metric.py]: #%E7%AC%AC%E2%91%A0%E6%AD%A5%C2%A0%E9%85%8D%E7%BD%AEmetric.py%E6%96%87%E4%BB%B6
[_loss.py]: #%E7%AC%AC%E2%91%A1%E6%AD%A5%C2%A0%E9%85%8D%E7%BD%AEloss.py%E6%96%87%E4%BB%B6
[YOLOv5]: #%F0%9F%8C%9F%E6%9C%AC%E4%BA%BAYOLOv5%E7%B3%BB%E5%88%97%E5%AF%BC%E8%88%AA
[arxiv.org_pdf_2307.07662v1.pdf]: https://arxiv.org/pdf/2307.07662v1.pdf
[_ YOLOv8 _ MPDIoU _ _2023 _-CSDN]: https://yolov5.blog.csdn.net/article/details/132002708?spm=1001.2014.3001.5502
[YOLOv5 1]: https://so.csdn.net/so/search?q=YOLOv5%E6%BA%90%E7%A0%81&spm=1001.2101.3001.7020
[YOLOv5_1]: https://blog.csdn.net/weixin_43334693/article/details/129356033?spm=1001.2014.3001.5501
[YOLOv5_2_detect.py]: https://blog.csdn.net/weixin_43334693/article/details/129349094?spm=1001.2014.3001.5501
[YOLOv5_3_train.py]: https://blog.csdn.net/weixin_43334693/article/details/129460666?spm=1001.2014.3001.5501
[YOLOv5_4_val_test_.py]: https://blog.csdn.net/weixin_43334693/article/details/129649553?spm=1001.2014.3001.5501
[YOLOv5_5_yolov5s.yaml]: https://blog.csdn.net/weixin_43334693/article/details/129697521?spm=1001.2014.3001.5501
[YOLOv5_6_1_yolo.py]: https://blog.csdn.net/weixin_43334693/article/details/129803802?spm=1001.2014.3001.5501
[YOLOv5_7_2_common.py]: https://blog.csdn.net/weixin_43334693/article/details/129854764?spm=1001.2014.3001.5501
[YOLOv5_1 1]: https://blog.csdn.net/weixin_43334693/article/details/129981848?spm=1001.2014.3001.5501
[YOLOv5_2_labelimg]: https://blog.csdn.net/weixin_43334693/article/details/129995604?spm=1001.2014.3001.5501
[YOLOv5_3]: https://blog.csdn.net/weixin_43334693/article/details/130025866?spm=1001.2014.3001.5501
[YOLOv5_4]: https://blog.csdn.net/weixin_43334693/article/details/130043351?spm=1001.2014.3001.5501
[YOLOv5_5_pyqt5]: https://blog.csdn.net/weixin_43334693/article/details/130044342?spm=1001.2014.3001.5501