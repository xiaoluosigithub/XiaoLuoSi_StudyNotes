![](https://i-blog.csdnimg.cn/blog_migrate/15f2cc596fe33b25ec92ec7b5f79832d.gif)

![](https://i-blog.csdnimg.cn/blog_migrate/9ea39c12e113aa10c6ea02402e7d3210.png)

![962f7cb1b48f44e29d9beb1d499d0530.gif](https://i-blog.csdnimg.cn/blog_migrate/ac3c5d6bfbcbf982e8e9e3632d7f20d1.gif)ã€YOLOv5æ”¹è¿›ç³»åˆ—ã€‘å‰æœŸå›é¡¾ï¼š

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ0ï¼‰â€”â€”é‡è¦æ€§èƒ½æŒ‡æ ‡ä¸è®­ç»ƒç»“æœè¯„ä»·åŠåˆ†æ][YOLOv5_0]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ1ï¼‰â€”â€”æ·»åŠ SEæ³¨æ„åŠ›æœºåˆ¶][YOLOv5_1_SE]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ2ï¼‰â€”â€”æ·»åŠ CBAMæ³¨æ„åŠ›æœºåˆ¶][YOLOv5_2_CBAM]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ3ï¼‰â€”â€”æ·»åŠ CAæ³¨æ„åŠ›æœºåˆ¶][YOLOv5_3_CA]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ4ï¼‰â€”â€”æ·»åŠ ECAæ³¨æ„åŠ›æœºåˆ¶][YOLOv5_4_ECA]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ5ï¼‰â€”â€”æ›¿æ¢ä¸»å¹²ç½‘ç»œä¹‹ MobileNetV3][YOLOv5_5_ MobileNetV3]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ6ï¼‰â€”â€”æ›¿æ¢ä¸»å¹²ç½‘ç»œä¹‹ ShuffleNetV2][YOLOv5_6_ ShuffleNetV2]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ7ï¼‰â€”â€”æ·»åŠ SimAMæ³¨æ„åŠ›æœºåˆ¶][YOLOv5_7_SimAM]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ8ï¼‰â€”â€”æ·»åŠ SOCAæ³¨æ„åŠ›æœºåˆ¶][YOLOv5_8_SOCA]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ9ï¼‰â€”â€”æ›¿æ¢ä¸»å¹²ç½‘ç»œä¹‹EfficientNetv2][YOLOv5_9_EfficientNetv2]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ10ï¼‰â€”â€”æ›¿æ¢ä¸»å¹²ç½‘ç»œä¹‹GhostNet][YOLOv5_10_GhostNet]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ11ï¼‰â€”â€”æ·»åŠ æŸå¤±å‡½æ•°ä¹‹EIoUã€AlphaIoUã€SIoUã€WIoU][YOLOv5_11_EIoU_AlphaIoU_SIoU_WIoU]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ12ï¼‰â€”â€”æ›´æ¢Neckä¹‹BiFPN][YOLOv5_12_Neck_BiFPN]

[YOLOv5æ”¹è¿›ç³»åˆ—ï¼ˆ13ï¼‰â€”â€”æ›´æ¢æ¿€æ´»å‡½æ•°ä¹‹SiLUï¼ŒReLUï¼ŒELUï¼ŒHardswishï¼ŒMishï¼ŒSoftplusï¼ŒAconCç³»åˆ—ç­‰][YOLOv5_13_SiLU_ReLU_ELU_Hardswish_Mish_Softplus_AconC]

![](https://i-blog.csdnimg.cn/blog_migrate/6e7df20d56b4203546bb53ba6b10bb0e.gif)

ç›®å½•

[â˜€ï¸ä¸€ã€NMSï¼ˆéæå¤§æŠ‘åˆ¶ï¼‰ç®€ä»‹][NMS]

[1.1 ä»€ä¹ˆæ˜¯NMSï¼Ÿ][1.1 _NMS]

[1.2 NMSçš„è®¡ç®—è¿‡ç¨‹][1.2 NMS]

[1.3 NMSçš„å±€é™æ€§][1.3 NMS]

[1.4 NMSçš„æ”¹è¿›æ€è·¯][1.4 NMS]

[â˜€ï¸äºŒã€DIoU-NMSã€CIoU-NMSã€EIoU-NMSã€GIoU-NMS ã€ SIoU-NMS][DIoU-NMS_CIoU-NMS_EIoU-NMS_GIoU-NMS _ SIoU-NMS]

[ğŸŒ²2.1 æ›´æ¢DIoU-NMS][2.1 _DIoU-NMS]

[ç¬¬â‘ æ­¥ ä¿®æ”¹general.py][_general.py]

[ç¬¬â‘¡æ­¥ æ›´æ¢NMS][_NMS]

[ğŸŒ²2.2 æ›´æ¢å…¶ä»–çš„NMS][2.2 _NMS]

[â˜€ï¸ä¸‰ã€Soft-NMS][Soft-NMS]

[ç¬¬â‘ æ­¥ ä¿®æ”¹general.py][_general.py]

[ç¬¬â‘¡æ­¥ æ›´æ¢NMS][_NMS]

[ğŸŒŸæœ¬äººYOLOv5ç³»åˆ—å¯¼èˆª][YOLOv5]

![](https://i-blog.csdnimg.cn/blog_migrate/dab4cd356232f776767a88a126b2bf06.gif)

## â˜€ï¸ä¸€ã€NMSï¼ˆéæå¤§æŠ‘åˆ¶ï¼‰ç®€ä»‹ 

### 1.1 ä»€ä¹ˆæ˜¯NMSï¼Ÿ 

NMSï¼ˆnon maximum suppressionï¼‰å³éæå¤§æŠ‘åˆ¶ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æŠ‘åˆ¶ä¸æ˜¯æå¤§å€¼çš„å…ƒç´ ï¼Œæœç´¢å±€éƒ¨çš„æå¤§å€¼ã€‚åœ¨æœ€è¿‘å‡ å¹´å¸¸è§çš„ç‰©ä½“æ£€æµ‹ç®—æ³•ï¼ˆåŒ…æ‹¬RCNNã€SPPNetã€Fast-RCNNã€Faster-RCNNç­‰ï¼‰ä¸­ï¼Œæœ€ç»ˆéƒ½ä¼šä»ä¸€å¼ å›¾ç‰‡ä¸­æ‰¾å‡ºå¾ˆå¤šä¸ªå¯èƒ½æ˜¯ç‰©ä½“çš„çŸ©å½¢æ¡†ï¼Œç„¶åä¸ºæ¯ä¸ªçŸ©å½¢æ¡†ä¸ºåšç±»åˆ«åˆ†ç±»æ¦‚ç‡ã€‚

å¦‚æœç”¨ä¸€å¥è¯æ¦‚æ‹¬NMSçš„æ„æ€å°±æ˜¯ï¼šç­›é€‰å‡ºä¸€å®šåŒºåŸŸå†…å±äºåŒä¸€ç§ç±»åˆ«å¾—åˆ†æœ€å¤§çš„æ¡†ã€‚

å¦‚ä¸‹å›¾ï¼Œç½‘ç»œæ¨¡å‹å¯ä»¥ç»™æ¯ä¸ªæ£€æµ‹æ¡†ä¸€ä¸ªscoreï¼Œscoreè¶Šå¤§ï¼Œè¯´æ˜æ£€æµ‹æ¡†è¶Šæ¥è¿‘çœŸå®å€¼ã€‚

![](https://i-blog.csdnimg.cn/blog_migrate/aed9d82ceee2097a1fc1c6d3eeee2c9e.png) ã€Šè€å‹è®°ã€‹yydsï¼

ç„¶åéæœ€å¤§å€¼æŠ‘åˆ¶çš„ç›®çš„æ˜¯åˆ é™¤scoreå°çš„æ¡†ï¼Œåªå‰©ä¸‹soreæœ€å¤§ä½œä¸ºæœ€ç»ˆçš„é¢„æµ‹ç»“æœã€‚

![](https://i-blog.csdnimg.cn/blog_migrate/c61972d5e21807a1230cc13fb179dca0.png)

### 1.2 NMSçš„è®¡ç®—è¿‡ç¨‹ 

 *  å®šä¹‰ç½®ä¿¡åº¦é˜ˆå€¼å’ŒIOUé˜ˆå€¼å–å€¼
 *  æŒ‰ç½®ä¿¡åº¦é™åºæ’åˆ—è¾¹ç•Œæ¡†bounding\_box
 *  ä»bbox\_listä¸­åˆ é™¤ç½®ä¿¡åº¦å°äºé˜ˆå€¼çš„é¢„æµ‹æ¡†
 *  å¾ªç¯éå†å‰©ä½™æ¡†ï¼Œé¦–å…ˆæŒ‘é€‰ç½®ä¿¡åº¦æœ€é«˜çš„æ¡†ä½œä¸ºå€™é€‰æ¡†
 *  æ¥ç€è®¡ç®—å…¶ä»–å’Œå€™é€‰æ¡†å±äºåŒä¸€ç±»çš„æ‰€æœ‰é¢„æµ‹æ¡†å’Œå½“å‰å€™é€‰æ¡†çš„IOU
 *  å¦‚æœä¸Šè¿°ä»»ä¸¤ä¸ªæ¡†çš„IOUçš„å€¼å¤§äºIOUé˜ˆå€¼ï¼Œé‚£ä¹ˆä»box\_listä¸­ç§»é™¤ç½®ä¿¡åº¦è¾ƒä½çš„é¢„æµ‹æ¡†
 *  é‡å¤æ­¤æ“ä½œï¼Œç›´åˆ°éå†å®Œåˆ—è¡¨ä¸­çš„æ‰€æœ‰é¢„æµ‹æ¡†

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/6007aac6c76014ab34a281a9200f2065.png)

### 1.3 NMSçš„å±€é™æ€§ 

ï¼ˆ1ï¼‰éœ€è¦æ‰‹åŠ¨è®¾ç½®é˜ˆå€¼ï¼Œé˜ˆå€¼çš„è®¾ç½®ä¼šç›´æ¥å½±å“é‡å ç›®æ ‡çš„æ£€æµ‹ï¼Œå¤ªå¤§é€ æˆè¯¯æ£€ï¼Œå¤ªå°è¾¾ä¸åˆ°ç†æƒ³æƒ…å†µã€‚

ï¼ˆ2ï¼‰ä½äºé˜ˆå€¼çš„ç›´æ¥è®¾ç½®scoreä¸º0ï¼Œåšæ³•å°±æ¯”è¾ƒéº»çƒ¦äº†

ï¼ˆ3ï¼‰é€šè¿‡IoUæ¥è¯„ä¼°ï¼ŒIoUçš„åšæ³•å¯¹ç›®æ ‡æ¡†å°ºåº¦å’Œè·ç¦»çš„å½±å“ä¸åŒ

### 1.4 NMSçš„æ”¹è¿›æ€è·¯ 

ï¼ˆ1ï¼‰æ ¹æ®æ‰‹åŠ¨è®¾ç½®é˜ˆå€¼çš„ç¼ºé™·ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æ–¹æ³•åœ¨ç›®æ ‡ç¨€ç–æ—¶ä½¿ç”¨å°é˜ˆå€¼ï¼Œç›®æ ‡ç¨ å¯†æ—¶ä½¿ç”¨å¤§é˜ˆå€¼ã€‚ä¾‹å¦‚Adaptive NMS  
ï¼ˆ2ï¼‰ç”±äºå°†ä½äºé˜ˆå€¼çš„ç›´æ¥ç½®ä¸º0çš„åšæ³•æ¯”è¾ƒå›°éš¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å…¶æ ¹æ®IoUå¤§å°æ¥è¿›è¡Œæƒ©ç½šè¡°å‡ï¼Œåˆ™å˜å¾—æ›´åŠ å¹³æ»‘ã€‚ä¾‹å¦‚Soft NMSï¼ŒSofter NMS  
ï¼ˆ3ï¼‰IoUçš„åšæ³•å­˜åœ¨ä¸€å®šç¼ºé™·ï¼Œæ”¹è¿›æ€è·¯æ˜¯å°†ç›®æ ‡å°ºåº¦ã€è·ç¦»å¼•è¿›IoUçš„è€ƒè™‘ä¸­ã€‚å¦‚DIoUç­‰

## â˜€ï¸äºŒã€DIoU-NMSã€CIoU-NMSã€EIoU-NMSã€GIoU-NMS ã€ SIoU-NMS 

### ğŸŒ²2.1 æ›´æ¢DIoU-NMS 

> è®ºæ–‡ï¼š[https://arxiv.org/pdf/1911.08287.pdf][https_arxiv.org_pdf_1911.08287.pdf].

ä¸€ä¸ªæˆç†Ÿçš„IoUè¡¡é‡æŒ‡æ ‡åº”è¯¥è¦è€ƒè™‘é¢„æµ‹æ¡†ä¸çœŸå®æ¡†çš„é‡å é¢ç§¯ã€ä¸­å¿ƒç‚¹è·ç¦»ã€é•¿å®½æ¯”ä¸‰ä¸ªæ–¹é¢ã€‚ä½†æ˜¯IoU åªè€ƒè™‘åˆ°äº†é¢„æµ‹æ¡†ä¸çœŸå®æ¡†é‡å åŒºåŸŸï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°ä¸­å¿ƒç‚¹è·ç¦»ã€é•¿å®½æ¯”ã€‚

DIoU-NMSåœ¨DIoUlossä¸€æ–‡ä¸­æå‡ºï¼Œä¸ä»…ä»…è€ƒè™‘IoUï¼Œè¿˜è€ƒè™‘ä¸¤ä¸ªæ¡†ä¸­å¿ƒç‚¹ä¹‹é—´çš„è·ç¦»ã€‚å¦‚æœä¸¤ä¸ªæ¡†ä¹‹é—´IoUæ¯”è¾ƒå¤§ï¼Œä½†æ˜¯ä¸¤ä¸ªæ¡†çš„ä¸­å¿ƒè·ç¦»æ¯”è¾ƒå¤§æ—¶ï¼Œå¯èƒ½ä¼šè®¤ä¸ºè¿™æ˜¯ä¸¤ä¸ªç‰©ä½“çš„æ¡†è€Œä¸ä¼šè¢«è¿‡æ»¤æ‰ã€‚ç”±äºDIoUçš„è®¡ç®—è€ƒè™‘åˆ°äº†ä¸¤æ¡†ä¸­å¿ƒç‚¹ä½ç½®çš„ä¿¡æ¯ï¼Œæ•…ä½¿ç”¨DIoUè¿›è¡Œè¯„åˆ¤çš„nmsæ•ˆæœæ›´ç¬¦åˆå®é™…ï¼Œæ•ˆæœæ›´ä¼˜ã€‚

å…¬å¼ï¼š![](https://i-blog.csdnimg.cn/blog_migrate/f30bc25ef98875888774d4dca7e9c07d.png)

#### ç¬¬â‘ æ­¥ ä¿®æ”¹general.py 

åœ¨YOLOv5å½“ä¸­ï¼Œä½œè€…æ˜¯ç›´æ¥è°ƒç”¨äº†Pytorchå®˜æ–¹çš„NMSçš„APIã€‚

ä¹Ÿå°±æ˜¯åœ¨general.pyä¸­çš„non\_max\_suppressionå‡½æ•°ä¸­

```java

```

é¦–å…ˆå°†ä¸‹é¢ä¸€æ®µä»£ç ç²˜è´´åˆ°utils/general.pyï¼Œé‡æ–°å®šä¹‰NMSæ¨¡å—ã€‚è¿™é‡Œçš„è®¡ç®—IoUçš„å‡½æ•°bbox\_iouåˆ™æ˜¯ç›´æ¥å¼•ç”¨äº†YOLOv5ä¸­çš„ä»£ç ï¼Œå…¶ç®€æ´çš„é›†æˆäº†CIoUã€SIoUã€EIoUã€GIoUã€DIoU çš„è®¡ç®—ã€‚

```java
def NMS(boxes, scores, iou_thres, class_nms='CIoU'):
    # class_nms=class_nms
    GIoU=CIoU=DIoU=EIoU=SIoU=False
    if class_nms == 'CIoU':
        CIoU=True
    elif class_nms == 'DIoU':
        DIoU=True
    elif class_nms == 'GIoU':
        GIoU=True
    elif class_nms == 'EIoU':
        EIoU=True
    else :
        SIoU=True
    B = torch.argsort(scores, dim=-1, descending=True)
    keep = []
    while B.numel() > 0:
        index = B[0]
        keep.append(index)
        if B.numel() == 1: break
        iou = bbox_iou(boxes[index, :], boxes[B[1:], :], GIoU=GIoU, DIoU=DIoU, CIoU=CIoU, EIoU=EIoU, SIoU=SIoU)
        inds = torch.nonzero(iou <= iou_thres).reshape(-1)
        B = B[inds + 1]
    return torch.tensor(keep)
```

#### ç¬¬â‘¡æ­¥ æ›´æ¢NMS 

ç„¶åæˆ‘ä»¬å°†non\_max\_suppression å‡½æ•°ä¸­çš„

```java
i = torchvision.ops.nms(boxes, scores, iou_thres)
```

æ›¿æ¢ä¸º

```java
i = NMS(boxes, scores, iou_thres, class_nms='DIoU')
```

è¿™æ ·å°±å¯ä»¥è¿˜æ˜¯è®­ç»ƒäº†~

### ğŸŒ²2.2 æ›´æ¢å…¶ä»–çš„NMS 

å…¶ä½™å‡ ä¸ªæ–¹æ³•éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªéœ€è¦åœ¨ç¬¬â‘¡æ­¥æ”¹ä¸ªåç§°å³å¯ï¼š

 *  DloUï¼š

```java
i = NMS(boxes, scores, iou_thres, class_nms='DIoU')
```

 *  SloUï¼š

```java
i = NMS(boxes, scores, iou_thres, class_nms='SIoU')
```

 *  GloUï¼š

```java
i = NMS(boxes, scores, iou_thres, class_nms='GIoU')
```

 *  EloUï¼š

```java
i = NMS(boxes, scores, iou_thres, class_nms='EIoU')
```

## â˜€ï¸ä¸‰ã€Soft-NMS 

> è®ºæ–‡ï¼š[https://arxiv.org/abs/1704.04503][https_arxiv.org_abs_1704.04503]

æ ¹æ®å‰é¢å¯¹ç›®æ ‡æ£€æµ‹ä¸­NMSçš„ç®—æ³•æè¿°ï¼Œæ˜“å¾—å‡ºä¼ ç»ŸNMSçš„ä¸è¶³ï¼šå¦‚æœä¸€ä¸ªç‰©ä½“åœ¨å¦ä¸€ä¸ªç‰©ä½“é‡å åŒºåŸŸå‡ºç°ï¼Œå³å½“ä¸¤ä¸ªç›®æ ‡æ¡†æ¥è¿‘æ—¶ï¼Œåˆ†æ•°æ›´ä½çš„æ¡†å°±ä¼šå› ä¸ºä¸ä¹‹é‡å é¢ç§¯è¿‡å¤§è€Œè¢«åˆ æ‰ï¼Œä»è€Œå¯¼è‡´å¯¹è¯¥ç‰©ä½“çš„æ£€æµ‹å¤±è´¥å¹¶é™ä½äº†ç®—æ³•çš„å¹³å‡æ£€æµ‹ç‡ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/ce6c82732aff38c5a177af95097e8509.png)

ä¸Šå›¾ä¸­ï¼Œæœ‰ä¸¤åŒ¹é©¬ï¼Œéƒ½æ˜¯å¾…æ£€æµ‹ç›®æ ‡ï¼Œä¹Ÿæœ‰ä¸¤ä¸ªæ£€æµ‹åˆ°çš„æ¡†ï¼Œå¾—åˆ†åˆ†åˆ«æ˜¯0.80å’Œ0.95  
å¦‚æœç”¨NMSç®—æ³•ï¼Œå¾—åˆ†æœ€é«˜çš„æ¡†æ˜¯çº¢è‰²æ¡†ï¼Œå¾—åˆ†0.95ï¼Œè€Œç»¿è‰²æ¡†ä¸çº¢è‰²æ¡†é€šè¿‡è®¡ç®—IoUï¼Œè‚¯å®šæ˜¯å¤§äºä¸€èˆ¬æˆ‘ä»¬è®¾ç½®çš„0.5çš„ï¼Œé‚£ä¹ˆç»¿è‰²æ¡†å°±ä¼šè¢«åˆ é™¤ï¼Œå¯¼è‡´å°‘æ£€æµ‹åˆ°ä¸€åŒ¹é©¬çš„æƒ…å†µã€‚æ­¤å¤–ï¼ŒNMSç®—æ³•è®¾ç½®é˜ˆå€¼ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œå¦‚æœè®¾ç½®è¿‡å°ï¼Œé‚£ä¹ˆä¼šå‡ºå…ˆè¿™æ ·çš„äº‹æƒ…ï¼Œå°‘æ£€æµ‹åˆ°ç›®æ ‡ï¼›å¦‚æœè®¾ç½®è¿‡å¤§ï¼Œåˆä¼šç»å¸¸å‡ºå…ˆè¯¯æ£€ã€‚

å› æ­¤ï¼Œå‡ºç°å‡çº§ç‰ˆSoft-NMSã€‚å…·ä½“æµç¨‹å°±æ˜¯æˆ‘ä»¬æŠŠNMSç®—æ³•ä¸­å»é™¤å…¶ä»–è¾¹ç•Œæ¡†æ”¹æˆï¼Œä¿®æ”¹å…¶ä»–è¾¹ç•Œæ¡†çš„ç½®ä¿¡åº¦ã€‚

#### ç¬¬â‘ æ­¥ ä¿®æ”¹general.py 

åŒæ ·ï¼Œé¦–å…ˆå°†ä¸‹é¢ä¸€æ®µä»£ç ç²˜è´´åˆ°utils/general.pyï¼Œé‡æ–°å®šä¹‰NMSæ¨¡å—ã€‚

```java
def my_soft_nms(bboxes, scores, iou_thresh=0.5, sigma=0.5, score_threshold=0.25):
 
    bboxes = bboxes.contiguous()
 
    x1 = bboxes[:, 0]
    y1 = bboxes[:, 1]
    x2 = bboxes[:, 2]
    y2 = bboxes[:, 3]
    # è®¡ç®—æ¯ä¸ªboxçš„é¢ç§¯
    areas = (x2 - x1 + 1) * (y2 - y1 + 1)
    # é¦–å…ˆå¯¹æ‰€æœ‰å¾—åˆ†è¿›è¡Œä¸€æ¬¡é™åºæ’åˆ—,ä»…æ­¤ä¸€æ¬¡,ä»¥æé«˜åç»­æŸ¥æ‰¾æœ€å¤§å€¼é€Ÿåº¦. oederä¸ºé™åºæ’åˆ—åçš„ç´¢å¼•
    _, order = scores.sort(0, descending=True)
    # NMSå,ä¿å­˜ç•™ä¸‹æ¥çš„è¾¹æ¡†
    keep = []
 
    while order.numel() > 0:
        if order.numel() == 1:  # ä»…å‰©æœ€åä¸€ä¸ªboxçš„ç´¢å¼•
            i = order.item()
            keep.append(i)
            break
        else:
            i = order[0].item()  # ä¿ç•™é¦–ä¸ªå¾—åˆ†æœ€å¤§çš„è¾¹æ¡†boxç´¢å¼•,iä¸ºscoresä¸­å®é™…åæ ‡
            keep.append(i)
        # å·§å¦™ä½¿ç”¨tersor.clamp()å‡½æ•°æ±‚å–orderä¸­å½“å‰æ¡†[0]ä¹‹å¤–æ¯ä¸€ä¸ªè¾¹æ¡†,ä¸å½“å‰æ¡†[0]çš„æœ€å¤§å€¼å’Œæœ€å°å€¼
        xx1 = x1[order[1:]].clamp(min=x1[i])
        yy1 = y1[order[1:]].clamp(min=y1[i])
        xx2 = x2[order[1:]].clamp(max=x2[i])
        yy2 = y2[order[1:]].clamp(max=y2[i])
        # æ±‚å–orderä¸­å…¶ä»–æ¯ä¸€ä¸ªè¾¹æ¡†ä¸å½“å‰è¾¹æ¡†çš„äº¤é›†é¢ç§¯
        inter = (xx2 - xx1).clamp(min=0) * (yy2 - yy1).clamp(min=0)
        # è®¡ç®—orderä¸­å…¶ä»–æ¯ä¸€ä¸ªæ¡†ä¸å½“å‰æ¡†çš„IoU
        iou = inter / (areas[i] + areas[order[1:]] - inter)  # å…±order.numel()-1ä¸ª
 
        idx = (iou > iou_thresh).nonzero().squeeze()  # è·å–orderä¸­IoUå¤§äºé˜ˆå€¼çš„å…¶ä»–è¾¹æ¡†çš„ç´¢å¼•
        if idx.numel() > 0:
            iou = iou[idx]
            newScores = torch.exp(-torch.pow(iou, 2) / sigma)  # è®¡ç®—è¾¹æ¡†çš„å¾—åˆ†è¡°å‡
            scores[order[idx + 1]] *= newScores  # æ›´æ–°é‚£äº›IoUå¤§äºé˜ˆå€¼çš„è¾¹æ¡†çš„å¾—åˆ†
 
        newOrder = (scores[order[1:]] > score_threshold).nonzero().squeeze()
        if newOrder.numel() == 0:
            break
        else:
            newScores = scores[order[newOrder + 1]]
            maxScoreIndex = torch.argmax(newScores)
 
            if maxScoreIndex != 0:
                newOrder[[0, maxScoreIndex],] = newOrder[[maxScoreIndex, 0],]
            # æ›´æ–°order.
            order = order[newOrder + 1]
 
    # è¿”å›ä¿ç•™ä¸‹æ¥çš„æ‰€æœ‰è¾¹æ¡†çš„ç´¢å¼•å€¼,ç±»å‹torch.LongTensor
    return torch.LongTensor(keep)
```

#### ç¬¬â‘¡æ­¥ æ›´æ¢NMS 

å°†general.pyä¸­å°†NMSæ”¹ä¸ºsoft nmsã€‚

è¿™æ­¥ä¹Ÿæ˜¯å’Œä¸Šé¢ä¸€æ ·ï¼Œå°†non\_max\_suppression å‡½æ•°ä¸­çš„

```java
i = torchvision.ops.nms(boxes, scores, iou_thres)
```

æ›¿æ¢ä¸º

```java
i = my_soft_nms(boxes, scores, iou_thres)  #
```

æœ€åå°±å¯ä»¥å¼€å§‹è®­ç»ƒäº†~

## ğŸŒŸæœ¬äººYOLOv5ç³»åˆ—å¯¼èˆª 

![962f7cb1b48f44e29d9beb1d499d0530.gif](https://i-blog.csdnimg.cn/blog_migrate/ac3c5d6bfbcbf982e8e9e3632d7f20d1.gif) ğŸ€[YOLOv5æºç ][YOLOv5 1]è¯¦è§£ç³»åˆ—ï¼š

[YOLOv5æºç é€è¡Œè¶…è¯¦ç»†æ³¨é‡Šä¸è§£è¯»ï¼ˆ1ï¼‰â€”â€”é¡¹ç›®ç›®å½•ç»“æ„è§£æ][YOLOv5_1]

[YOLOv5æºç é€è¡Œè¶…è¯¦ç»†æ³¨é‡Šä¸è§£è¯»ï¼ˆ2ï¼‰â€”â€”æ¨ç†éƒ¨åˆ†detect.py][YOLOv5_2_detect.py]

[YOLOv5æºç é€è¡Œè¶…è¯¦ç»†æ³¨é‡Šä¸è§£è¯»ï¼ˆ3ï¼‰â€”â€”è®­ç»ƒéƒ¨åˆ†train.py][YOLOv5_3_train.py]

[YOLOv5æºç é€è¡Œè¶…è¯¦ç»†æ³¨é‡Šä¸è§£è¯»ï¼ˆ4ï¼‰â€”â€”éªŒè¯éƒ¨åˆ†valï¼ˆtestï¼‰.py][YOLOv5_4_val_test_.py]

[YOLOv5æºç é€è¡Œè¶…è¯¦ç»†æ³¨é‡Šä¸è§£è¯»ï¼ˆ5ï¼‰â€”â€”é…ç½®æ–‡ä»¶yolov5s.yaml][YOLOv5_5_yolov5s.yaml]

[YOLOv5æºç é€è¡Œè¶…è¯¦ç»†æ³¨é‡Šä¸è§£è¯»ï¼ˆ6ï¼‰â€”â€”ç½‘ç»œç»“æ„ï¼ˆ1ï¼‰yolo.py][YOLOv5_6_1_yolo.py]

[YOLOv5æºç é€è¡Œè¶…è¯¦ç»†æ³¨é‡Šä¸è§£è¯»ï¼ˆ7ï¼‰â€”â€”ç½‘ç»œç»“æ„ï¼ˆ2ï¼‰common.py][YOLOv5_7_2_common.py]

![962f7cb1b48f44e29d9beb1d499d0530.gif](https://i-blog.csdnimg.cn/blog_migrate/ac3c5d6bfbcbf982e8e9e3632d7f20d1.gif) ğŸ€[YOLOv5å…¥é—¨å®è·µ][YOLOv5 1]ç³»åˆ—ï¼š

[YOLOv5å…¥é—¨å®è·µï¼ˆ1ï¼‰â€”â€”æ‰‹æŠŠæ‰‹å¸¦ä½ ç¯å¢ƒé…ç½®æ­å»º][YOLOv5_1 1]

[YOLOv5å…¥é—¨å®è·µï¼ˆ2ï¼‰â€”â€”æ‰‹æŠŠæ‰‹æ•™ä½ åˆ©ç”¨labelimgæ ‡æ³¨æ•°æ®é›†][YOLOv5_2_labelimg]

[YOLOv5å…¥é—¨å®è·µï¼ˆ3ï¼‰â€”â€”æ‰‹æŠŠæ‰‹æ•™ä½ åˆ’åˆ†è‡ªå·±çš„æ•°æ®é›†][YOLOv5_3]

[YOLOv5å…¥é—¨å®è·µï¼ˆ4ï¼‰â€”â€”æ‰‹æŠŠæ‰‹æ•™ä½ è®­ç»ƒè‡ªå·±çš„æ•°æ®é›†][YOLOv5_4]

[YOLOv5å…¥é—¨å®è·µï¼ˆ5ï¼‰â€”â€”ä»é›¶å¼€å§‹ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ è®­ç»ƒè‡ªå·±çš„ç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼ˆåŒ…å«pyqt5ç•Œé¢ï¼‰][YOLOv5_5_pyqt5]

![](https://i-blog.csdnimg.cn/blog_migrate/64923ef5714873f1b50af2ac7205bdde.gif)


[YOLOv5_0]: https://blog.csdn.net/weixin_43334693/article/details/130564848?spm=1001.2014.3001.5501
[YOLOv5_1_SE]: https://blog.csdn.net/weixin_43334693/article/details/130551913?spm=1001.2014.3001.5501
[YOLOv5_2_CBAM]: https://blog.csdn.net/weixin_43334693/article/details/130587102?spm=1001.2014.3001.5501
[YOLOv5_3_CA]: https://blog.csdn.net/weixin_43334693/article/details/130619604?spm=1001.2014.3001.5501
[YOLOv5_4_ECA]: https://blog.csdn.net/weixin_43334693/article/details/130641318?spm=1001.2014.3001.5501
[YOLOv5_5_ MobileNetV3]: https://blog.csdn.net/weixin_43334693/article/details/130832933?spm=1001.2014.3001.5501
[YOLOv5_6_ ShuffleNetV2]: https://blog.csdn.net/weixin_43334693/article/details/131008642?spm=1001.2014.3001.5501
[YOLOv5_7_SimAM]: https://blog.csdn.net/weixin_43334693/article/details/131031541?spm=1001.2014.3001.5501
[YOLOv5_8_SOCA]: https://blog.csdn.net/weixin_43334693/article/details/131053284?spm=1001.2014.3001.5501
[YOLOv5_9_EfficientNetv2]: https://blog.csdn.net/weixin_43334693/article/details/131207097?csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22article%22%2C%22rId%22%3A%22131207097%22%2C%22source%22%3A%22weixin_43334693%22%7D
[YOLOv5_10_GhostNet]: https://blog.csdn.net/weixin_43334693/article/details/131235113?spm=1001.2014.3001.5501
[YOLOv5_11_EIoU_AlphaIoU_SIoU_WIoU]: https://blog.csdn.net/weixin_43334693/article/details/131350224?spm=1001.2014.3001.5501
[YOLOv5_12_Neck_BiFPN]: https://blog.csdn.net/weixin_43334693/article/details/131461294?spm=1001.2014.3001.5501
[YOLOv5_13_SiLU_ReLU_ELU_Hardswish_Mish_Softplus_AconC]: https://blog.csdn.net/weixin_43334693/article/details/131513850?spm=1001.2014.3001.5502
[NMS]: #%E2%98%80%EF%B8%8F%E4%B8%80%E3%80%81NMS%EF%BC%88%E9%9D%9E%E6%9E%81%E5%A4%A7%E6%8A%91%E5%88%B6%EF%BC%89%E7%AE%80%E4%BB%8B
[1.1 _NMS]: #1.1%E4%BB%80%E4%B9%88%E6%98%AFNMS%EF%BC%9F
[1.2 NMS]: #1.2%20NMS%E7%9A%84%E8%AE%A1%E7%AE%97%E8%BF%87%E7%A8%8B
[1.3 NMS]: #1.3%C2%A0%C2%A0NMS%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7
[1.4 NMS]: #1.4%20NMS%E7%9A%84%E6%94%B9%E8%BF%9B%E6%80%9D%E8%B7%AF
[DIoU-NMS_CIoU-NMS_EIoU-NMS_GIoU-NMS _ SIoU-NMS]: #%F0%9F%8C%B2%E4%BA%8C%E3%80%81%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81%E7%9A%84%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0
[2.1 _DIoU-NMS]: #%F0%9F%8C%B22.1%20%E6%9B%B4%E6%8D%A2DIoU-NMS
[_general.py]: #%E7%AC%AC%E2%91%A0%E6%AD%A5%20%E4%BF%AE%E6%94%B9general.py
[_NMS]: #%E7%AC%AC%E2%91%A1%E6%AD%A5%20%E6%9B%B4%E6%8D%A2NMS
[2.2 _NMS]: #%F0%9F%8C%B22.2%20%E6%9B%B4%E6%8D%A2%E5%85%B6%E4%BB%96%E7%9A%84NMS
[Soft-NMS]: #%E2%98%80%EF%B8%8F%E4%B8%89%E3%80%81Soft-NMS
[YOLOv5]: #%F0%9F%8C%9F%E6%9C%AC%E4%BA%BAYOLOv5%E7%B3%BB%E5%88%97%E5%AF%BC%E8%88%AA
[https_arxiv.org_pdf_1911.08287.pdf]: https://arxiv.org/pdf/1911.08287.pdf
[https_arxiv.org_abs_1704.04503]: https://arxiv.org/abs/1704.04503
[YOLOv5 1]: https://so.csdn.net/so/search?q=YOLOv5%E6%BA%90%E7%A0%81&spm=1001.2101.3001.7020
[YOLOv5_1]: https://blog.csdn.net/weixin_43334693/article/details/129356033?spm=1001.2014.3001.5501
[YOLOv5_2_detect.py]: https://blog.csdn.net/weixin_43334693/article/details/129349094?spm=1001.2014.3001.5501
[YOLOv5_3_train.py]: https://blog.csdn.net/weixin_43334693/article/details/129460666?spm=1001.2014.3001.5501
[YOLOv5_4_val_test_.py]: https://blog.csdn.net/weixin_43334693/article/details/129649553?spm=1001.2014.3001.5501
[YOLOv5_5_yolov5s.yaml]: https://blog.csdn.net/weixin_43334693/article/details/129697521?spm=1001.2014.3001.5501
[YOLOv5_6_1_yolo.py]: https://blog.csdn.net/weixin_43334693/article/details/129803802?spm=1001.2014.3001.5501
[YOLOv5_7_2_common.py]: https://blog.csdn.net/weixin_43334693/article/details/129854764?spm=1001.2014.3001.5501
[YOLOv5_1 1]: https://blog.csdn.net/weixin_43334693/article/details/129981848?spm=1001.2014.3001.5501
[YOLOv5_2_labelimg]: https://blog.csdn.net/weixin_43334693/article/details/129995604?spm=1001.2014.3001.5501
[YOLOv5_3]: https://blog.csdn.net/weixin_43334693/article/details/130025866?spm=1001.2014.3001.5501
[YOLOv5_4]: https://blog.csdn.net/weixin_43334693/article/details/130043351?spm=1001.2014.3001.5501
[YOLOv5_5_pyqt5]: https://blog.csdn.net/weixin_43334693/article/details/130044342?spm=1001.2014.3001.5501